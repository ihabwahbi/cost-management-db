{
  "ai_agent_notes": {
    "to_add_new_column": [
      "1. Add column to src/schema/<table>.ts",
      "2. Run npm run db:drift, then apply the SQL manually",
      "3. Add CSV\u2192DB mapping in scripts/config/column_mappings.py",
      "4. Update relevant stage script to include the column",
      "5. Run python3 scripts/pipeline.py to regenerate data"
    ],
    "to_add_new_data_source": [
      "1. Place raw file in data/raw/",
      "2. Create new stage1 script (numbered appropriately)",
      "3. Add to STAGE1_SCRIPTS in pipeline.py",
      "4. Create column mappings if needed for import"
    ],
    "to_add_new_transformation": [
      "1. Identify which stage the transformation belongs to",
      "2. Add function to appropriate stage script",
      "3. Update the main() function to call new transformation",
      "4. Test with python3 scripts/pipeline.py"
    ]
  },
  "column_mappings": {
    "EXCLUDED_NIS_LEVELS": [
      "Compensation Business Delivery",
      "Compensation Business Enablement"
    ],
    "GRIR_EXPOSURES_MAPPING": {
      "Days Open": "days_open",
      "First Exposure Date": "first_exposure_date",
      "GRIR Qty": "grir_qty",
      "GRIR Value": "grir_value",
      "PO Line ID": "po_line_id",
      "Snapshot Date": "snapshot_date",
      "Time Bucket": "time_bucket"
    },
    "PO_LINE_ITEMS_MAPPING": {
      "Asset Code": "asset_code",
      "Expected Delivery Date": "expected_delivery_date",
      "FMT PO": "fmt_po",
      "Location": "location",
      "Main Vendor ID": "vendor_id",
      "Main Vendor Name": "vendor_name",
      "Main Vendor SLB Vendor Category": "vendor_category",
      "NIS Line": "nis_line",
      "Open PO Qty": "open_po_qty",
      "Open PO Value": "open_po_value",
      "Ordered Quantity": "ordered_qty",
      "PO Account Assignment Category": "account_assignment_category",
      "PO Approval Status": "po_approval_status",
      "PO Document Date": "po_creation_date",
      "PO GTS Status": "po_gts_status",
      "PO Line": "line_item_number",
      "PO Line ID": "po_line_id",
      "PO Material Number": "part_number",
      "PO Material description": "description",
      "PO Number": "po_number",
      "PO Order Unit": "order_unit",
      "PO Receipt Status": "po_receipt_status",
      "PO WBS Element": "wbs_number",
      "PR Line": "pr_line",
      "PR Number": "pr_number",
      "Plant Code": "plant_code",
      "Purchase Value USD": "po_value_usd",
      "Requester": "requester",
      "SL Sub-Business Line Code (BV Lvl 3)": "sub_business_line",
      "Ultimate Vendor Name": "ultimate_vendor_name"
    },
    "PO_TRANSACTIONS_MAPPING": {
      "Cost Impact Amount": "cost_impact_amount",
      "Cost Impact Qty": "cost_impact_qty",
      "PO Line ID": "po_line_id",
      "Posting Amount": "amount",
      "Posting Date": "posting_date",
      "Posting Qty": "quantity",
      "Posting Type": "transaction_type"
    },
    "SAP_RESERVATIONS_MAPPING": {
      "Combined SOH & PO Pegging": "reservation_status",
      "Creation Date": "reservation_creation_date",
      "Goods recipient": "requester_alias",
      "Material": "part_number",
      "Material Description": "description",
      "Open Qty - Reservation": "open_reservation_qty",
      "Open Reservation Value": "open_reservation_value",
      "Plant": "plant_code",
      "Requirements Date": "reservation_requirement_date",
      "Reservation Creation type": "reservation_source",
      "WBS Element": "wbs_number",
      "reservation_line_id": "reservation_line_id",
      "reservation_line_number": "reservation_line_number",
      "reservation_number": "reservation_number"
    },
    "SIMPLE_ACCOUNT_CATEGORIES": [
      "K",
      "P",
      "S",
      "V"
    ],
    "VENDOR_NAME_MAPPING": {
      "P9032": "FCS",
      "P9035": "HCS",
      "P9036": "HFE",
      "P9052": "SRC",
      "P9057": "SKK",
      "P9060": "SRPC",
      "P9064": "PPCS",
      "P9066": "SWTC",
      "P9071": "PPCU",
      "P9086": "ONESUBSEA",
      "P9097": "Rotterdam Hub",
      "P9107": "NAM RDC",
      "P9109": "Houston Hub",
      "P9514": "Canada Hub",
      "P9516": "Dubai Hub",
      "P9517": "Shanghai Hub",
      "P9518": "Singapore Hub",
      "P9519": "Japan Hub",
      "P9562": "QRTC"
    },
    "WBS_DETAILS_MAPPING": {
      "client_name": "client_name",
      "location": "location",
      "operation_number": "operation_number",
      "ops_activity_number": "ops_activity_number",
      "ops_district": "ops_district",
      "project_number": "project_number",
      "rig": "rig",
      "sub_business_lines": "sub_business_lines",
      "wbs_name": "wbs_name",
      "wbs_number": "wbs_number",
      "wbs_source": "wbs_source"
    }
  },
  "common_errors": {
    "FileNotFoundError": {
      "causes": [
        "Previous pipeline stage didn't run",
        "Raw data files missing"
      ],
      "pattern": "No such file or directory.*data/",
      "solutions": [
        "Check data/raw/ for source files",
        "Run earlier stages first: python3 scripts/pipeline.py --stage1"
      ]
    },
    "KeyError": {
      "causes": [
        "Column doesn't exist in DataFrame",
        "Column name has different casing or spacing",
        "Previous script in pipeline didn't run"
      ],
      "pattern": "KeyError: '(.+)'",
      "solutions": [
        "Check column_mappings.py for correct column names",
        "Run full pipeline: python3 scripts/pipeline.py",
        "Use df.columns.tolist() to see actual column names"
      ]
    },
    "MergeError": {
      "causes": [
        "Join columns have different dtypes (int vs str)",
        "One side has NaN values causing type inference issues"
      ],
      "pattern": "merge.*dtype",
      "solutions": [
        "Check for nulls before merge: df['col'].isnull().sum()",
        "Ensure both join columns are same type: df['col'] = df['col'].astype(str)"
      ]
    },
    "SchemaValidationError": {
      "causes": [
        "Column dropped in earlier transformation",
        "Database schema changed but CSV mapping not updated"
      ],
      "pattern": "column.*not found|missing required column",
      "solutions": [
        "Compare column_mappings.py with src/schema/*.ts",
        "Run npm run type-check after schema changes"
      ]
    },
    "ValueError_date": {
      "causes": [
        "Date column has inconsistent formats",
        "Non-date values in date column"
      ],
      "pattern": "time data.*does not match format",
      "solutions": [
        "Check for non-date values: df[pd.to_datetime(df['col'], errors='coerce').isna()]",
        "Use pd.to_datetime with errors='coerce'"
      ]
    }
  },
  "data_files": {
    "import-ready": [
      "grir_exposures.csv",
      "po_line_items.csv",
      "po_transactions.csv",
      "sap_reservations.csv",
      "wbs_details.csv"
    ],
    "intermediate": [
      "cost_impact.csv",
      "gr_postings.csv",
      "grir_exposures.csv",
      "ir_postings.csv",
      "po_details_enrichment.csv",
      "po_line_items.csv",
      "reservations.csv",
      "unmatched_reservation_pos.csv",
      "wbs_from_operations.csv",
      "wbs_from_ops_activities.csv",
      "wbs_from_projects.csv",
      "wbs_processed.csv"
    ],
    "raw": [
      "gr table.csv",
      "invoice table.csv",
      "po details report.xlsx",
      "po line items.csv"
    ]
  },
  "data_profiles": {
    "cost_impact.csv": {
      "columns": [
        "Cost Impact Amount",
        "Cost Impact Qty",
        "PO Line ID",
        "Posting Date",
        "Posting Qty",
        "Posting Type"
      ],
      "dtypes": {
        "Cost Impact Amount": "float64",
        "Cost Impact Qty": "float64",
        "PO Line ID": "object",
        "Posting Date": "object",
        "Posting Qty": "float64",
        "Posting Type": "object"
      },
      "null_counts": {},
      "path": "data/intermediate/cost_impact.csv",
      "row_count": 108592,
      "sample_row": {
        "Cost Impact Amount": 52.0,
        "Cost Impact Qty": 20.0,
        "PO Line ID": "4581911397-1",
        "Posting Date": "2023-01-16 00:00:00",
        "Posting Qty": 20.0,
        "Posting Type": "IR"
      }
    },
    "gr table.csv": {
      "columns": [
        "GR Effective Quantity",
        "GR Posting Date",
        "PO Line ID"
      ],
      "dtypes": {
        "GR Effective Quantity": "float64",
        "GR Posting Date": "object",
        "PO Line ID": "object"
      },
      "null_counts": {},
      "path": "data/raw/gr table.csv",
      "row_count": 78512,
      "sample_row": {
        "GR Effective Quantity": 0.0,
        "GR Posting Date": "2023-06-06 00:00:00.000",
        "PO Line ID": "4581717940-1"
      }
    },
    "gr_postings.csv": {
      "columns": [
        "GR Amount",
        "GR Effective Quantity",
        "GR Posting Date",
        "PO Line ID"
      ],
      "dtypes": {
        "GR Amount": "float64",
        "GR Effective Quantity": "float64",
        "GR Posting Date": "object",
        "PO Line ID": "object"
      },
      "null_counts": {},
      "path": "data/intermediate/gr_postings.csv",
      "row_count": 55115,
      "sample_row": {
        "GR Amount": 52.0,
        "GR Effective Quantity": 20.0,
        "GR Posting Date": "2023-02-14 00:00:00.000",
        "PO Line ID": "4581911397-1"
      }
    },
    "grir_exposures.csv": {
      "columns": [
        "days_open",
        "first_exposure_date",
        "grir_qty",
        "grir_value",
        "po_line_id",
        "snapshot_date",
        "time_bucket"
      ],
      "dtypes": {
        "days_open": "int64",
        "first_exposure_date": "object",
        "grir_qty": "float64",
        "grir_value": "float64",
        "po_line_id": "object",
        "snapshot_date": "object",
        "time_bucket": "object"
      },
      "null_counts": {},
      "path": "data/import-ready/grir_exposures.csv",
      "row_count": 68,
      "sample_row": {
        "days_open": 59,
        "first_exposure_date": "2025-12-19",
        "grir_qty": 2.0,
        "grir_value": 28233.18,
        "po_line_id": "4584521978-1",
        "snapshot_date": "2026-02-16",
        "time_bucket": "1-3 months"
      }
    },
    "invoice table.csv": {
      "columns": [
        "IR Effective Quantity",
        "Invoice Posting Date",
        "PO Line ID"
      ],
      "dtypes": {
        "IR Effective Quantity": "float64",
        "Invoice Posting Date": "object",
        "PO Line ID": "object"
      },
      "null_counts": {},
      "path": "data/raw/invoice table.csv",
      "row_count": 66594,
      "sample_row": {
        "IR Effective Quantity": 2.0,
        "Invoice Posting Date": "2023-06-06 00:00:00.000",
        "PO Line ID": "4581717940-1"
      }
    },
    "ir_postings.csv": {
      "columns": [
        "IR Effective Quantity",
        "Invoice Amount",
        "Invoice Posting Date",
        "PO Line ID"
      ],
      "dtypes": {
        "IR Effective Quantity": "float64",
        "Invoice Amount": "float64",
        "Invoice Posting Date": "object",
        "PO Line ID": "object"
      },
      "null_counts": {},
      "path": "data/intermediate/ir_postings.csv",
      "row_count": 55204,
      "sample_row": {
        "IR Effective Quantity": 20.0,
        "Invoice Amount": 52.0,
        "Invoice Posting Date": "2023-01-16 00:00:00.000",
        "PO Line ID": "4581911397-1"
      }
    },
    "po line items.csv": {
      "columns": [
        "Main Vendor ID",
        "Main Vendor Name",
        "Main Vendor SLB Vendor Category",
        "NIS Level 0 Desc",
        "Open Qty",
        "Ordered Quantity",
        "PO Account Assignment Category",
        "PO Account Assignment Category Desc",
        "PO Approval Status",
        "PO Current Supplier Promised Date",
        "PO Current Supplier Requested Delivery Date",
        "PO Delivery Completed Indicator",
        "PO Document Date",
        "PO GTS Status",
        "PO Initial Output Date",
        "PO Invoice Status",
        "PO Line",
        "PO Line ID",
        "PO Material Number",
        "PO Material description",
        "PO Number",
        "PO Order Unit",
        "PO Receipt Status",
        "PO Valuation Class",
        "PO Valuation Class Desc",
        "PO WBS Element",
        "Plant Code",
        "Purchase Value USD",
        "SL Sub-Business Line Code (BV Lvl 3)",
        "Ultimate Vendor Name",
        "Ultimate Vendor Number"
      ],
      "dtypes": {
        "Main Vendor ID": "object",
        "Main Vendor Name": "object",
        "Main Vendor SLB Vendor Category": "object",
        "NIS Level 0 Desc": "object",
        "Open Qty": "float64",
        "Ordered Quantity": "float64",
        "PO Account Assignment Category": "object",
        "PO Account Assignment Category Desc": "object",
        "PO Approval Status": "object",
        "PO Current Supplier Promised Date": "object",
        "PO Current Supplier Requested Delivery Date": "object",
        "PO Delivery Completed Indicator": "object",
        "PO Document Date": "object",
        "PO GTS Status": "object",
        "PO Initial Output Date": "object",
        "PO Invoice Status": "object",
        "PO Line": "int64",
        "PO Line ID": "object",
        "PO Material Number": "object",
        "PO Material description": "object",
        "PO Number": "int64",
        "PO Order Unit": "object",
        "PO Receipt Status": "object",
        "PO Valuation Class": "float64",
        "PO Valuation Class Desc": "object",
        "PO WBS Element": "object",
        "Plant Code": "int64",
        "Purchase Value USD": "float64",
        "SL Sub-Business Line Code (BV Lvl 3)": "object",
        "Ultimate Vendor Name": "object",
        "Ultimate Vendor Number": "object"
      },
      "null_counts": {
        "NIS Level 0 Desc": 12537,
        "PO Account Assignment Category": 11063,
        "PO Account Assignment Category Desc": 11063,
        "PO Current Supplier Promised Date": 34514,
        "PO GTS Status": 110,
        "PO Initial Output Date": 134,
        "PO Material Number": 49765,
        "PO Valuation Class": 49765,
        "PO Valuation Class Desc": 49765,
        "PO WBS Element": 39484
      },
      "path": "data/raw/po line items.csv",
      "row_count": 64002,
      "sample_row": {
        "Main Vendor ID": "P9516",
        "Main Vendor Name": "Petroleum Equipment & Supplies FZE,",
        "Main Vendor SLB Vendor Category": "GLD",
        "NIS Level 0 Desc": NaN,
        "Open Qty": 0.0,
        "Ordered Quantity": 14.0,
        "PO Account Assignment Category": NaN,
        "PO Account Assignment Category Desc": NaN,
        "PO Approval Status": "Approved",
        "PO Current Supplier Promised Date": "2023-01-19 00:00:00.000",
        "PO Current Supplier Requested Delivery Date": "2023-01-27 00:00:00.000",
        "PO Delivery Completed Indicator": "Yes",
        "PO Document Date": "2023-01-02 00:00:00.000",
        "PO GTS Status": "PO Not blocked by GTS",
        "PO Initial Output Date": "2023-01-02 00:00:00.000",
        "PO Invoice Status": "Partially Paid",
        "PO Line": 2,
        "PO Line ID": "4581911397-2",
        "PO Material Number": "H400311",
        "PO Material description": "BOOT, MALE, .078 DIA",
        "PO Number": 4581911397,
        "PO Order Unit": "EA",
        "PO Receipt Status": "CLOSED PO",
        "PO Valuation Class": 3021.0,
        "PO Valuation Class Desc": "M&S OPS Materials",
        "PO WBS Element": NaN,
        "Plant Code": 3614,
        "Purchase Value USD": 81.62,
        "SL Sub-Business Line Code (BV Lvl 3)": "WLES",
        "Ultimate Vendor Name": "Petroleum Equipment & Supplies FZE,",
        "Ultimate Vendor Number": "P9516"
      }
    },
    "po_details_enrichment.csv": {
      "columns": [
        "PO Line ID",
        "PR Line",
        "PR Number",
        "Requester"
      ],
      "dtypes": {
        "PO Line ID": "object",
        "PR Line": "float64",
        "PR Number": "object",
        "Requester": "object"
      },
      "null_counts": {
        "PR Line": 2,
        "PR Number": 420,
        "Requester": 2394
      },
      "path": "data/intermediate/po_details_enrichment.csv",
      "row_count": 22089,
      "sample_row": {
        "PO Line ID": "4584629369-1",
        "PR Line": 10.0,
        "PR Number": "1003030890",
        "Requester": "Walid Benmehidi"
      }
    },
    "po_line_items.csv": {
      "columns": [
        "account_assignment_category",
        "cost_impact_pct",
        "cost_impact_value",
        "description",
        "expected_delivery_date",
        "fmt_po",
        "is_capex",
        "line_item_number",
        "location",
        "nis_line",
        "open_po_qty",
        "open_po_value",
        "order_unit",
        "ordered_qty",
        "part_number",
        "plant_code",
        "po_approval_status",
        "po_creation_date",
        "po_gts_status",
        "po_line_id",
        "po_number",
        "po_receipt_status",
        "po_value_usd",
        "pr_line",
        "pr_number",
        "requester",
        "sub_business_line",
        "ultimate_vendor_name",
        "vendor_category",
        "vendor_id",
        "vendor_name",
        "wbs_number",
        "wbs_validated"
      ],
      "dtypes": {
        "account_assignment_category": "object",
        "cost_impact_pct": "float64",
        "cost_impact_value": "float64",
        "description": "object",
        "expected_delivery_date": "object",
        "fmt_po": "bool",
        "is_capex": "bool",
        "line_item_number": "int64",
        "location": "object",
        "nis_line": "object",
        "open_po_qty": "float64",
        "open_po_value": "float64",
        "order_unit": "object",
        "ordered_qty": "float64",
        "part_number": "object",
        "plant_code": "int64",
        "po_approval_status": "object",
        "po_creation_date": "object",
        "po_gts_status": "object",
        "po_line_id": "object",
        "po_number": "int64",
        "po_receipt_status": "object",
        "po_value_usd": "float64",
        "pr_line": "float64",
        "pr_number": "float64",
        "requester": "object",
        "sub_business_line": "object",
        "ultimate_vendor_name": "object",
        "vendor_category": "object",
        "vendor_id": "object",
        "vendor_name": "object",
        "wbs_number": "object",
        "wbs_validated": "bool"
      },
      "null_counts": {
        "account_assignment_category": 8925,
        "cost_impact_pct": 27,
        "part_number": 47765,
        "po_gts_status": 62,
        "pr_line": 37313,
        "pr_number": 37702,
        "requester": 37216,
        "wbs_number": 32723
      },
      "path": "data/import-ready/po_line_items.csv",
      "row_count": 57184,
      "sample_row": {
        "account_assignment_category": NaN,
        "cost_impact_pct": 1.0,
        "cost_impact_value": 52.0,
        "description": "O-RING;332,2.35 IN,0.21 IN,FKM,95 DURO",
        "expected_delivery_date": "2023-01-19 00:00:00.000",
        "fmt_po": false,
        "is_capex": false,
        "line_item_number": 1,
        "location": "Moomba",
        "nis_line": "Materials and Supplies",
        "open_po_qty": 0.0,
        "open_po_value": 0.0,
        "order_unit": "EA",
        "ordered_qty": 20.0,
        "part_number": "B036231",
        "plant_code": 3614,
        "po_approval_status": "Approved",
        "po_creation_date": "2023-01-02 00:00:00.000",
        "po_gts_status": "PO Not blocked by GTS",
        "po_line_id": "4581911397-1",
        "po_number": 4581911397,
        "po_receipt_status": "CLOSED PO",
        "po_value_usd": 52.0,
        "pr_line": NaN,
        "pr_number": NaN,
        "requester": NaN,
        "sub_business_line": "WLPS",
        "ultimate_vendor_name": "Dubai Hub",
        "vendor_category": "GLD",
        "vendor_id": "P9516",
        "vendor_name": "Dubai Hub",
        "wbs_number": NaN,
        "wbs_validated": false
      }
    },
    "po_transactions.csv": {
      "columns": [
        "amount",
        "cost_impact_amount",
        "cost_impact_qty",
        "po_line_id",
        "posting_date",
        "quantity",
        "transaction_id",
        "transaction_type"
      ],
      "dtypes": {
        "amount": "float64",
        "cost_impact_amount": "float64",
        "cost_impact_qty": "float64",
        "po_line_id": "object",
        "posting_date": "object",
        "quantity": "float64",
        "transaction_id": "object",
        "transaction_type": "object"
      },
      "null_counts": {},
      "path": "data/import-ready/po_transactions.csv",
      "row_count": 108592,
      "sample_row": {
        "amount": 0.0,
        "cost_impact_amount": 0.0,
        "cost_impact_qty": 0.0,
        "po_line_id": "4581911397-1",
        "posting_date": "2023-02-14 00:00:00",
        "quantity": 20.0,
        "transaction_id": "4581911397-1-GR-20230214-001",
        "transaction_type": "GR"
      }
    },
    "reservations.csv": {
      "columns": [
        "Additional PO - Line to Peg",
        "Business Line - By Cost Center",
        "Business Line by Profit Center",
        "Combined SOH & PO Pegging",
        "Cost Center",
        "Creation Date",
        "GEO UNIT (Profit Center)",
        "Geo-Unit",
        "Goods recipient",
        "Index",
        "Last 12 Month Consumption",
        "Last 3 Month Consumption",
        "Last 6 Month Consumption",
        "MRP Parameters - MRP Controller",
        "MRP Parameters - Planned Delivery Time",
        "MRP Parameters - Prime Status",
        "MRP Parameters - Profit Center",
        "MRP Parameters - Safety Stock",
        "MRP Parameters - Standard Price",
        "Main - PO Line to Peg to Reservation",
        "Main - PO to Peg to Reservation",
        "Material",
        "Material Description",
        "Material Stratification (Last 12 Month Consumption)",
        "Material Stratification (Last 6 Month Consumption)",
        "Material-Plant",
        "Material/Plant-Open PO Qty - Total",
        "Material/Plant-SOH - Total",
        "Maximo - WO STATUS and Part Status",
        "Maximo Asset ID",
        "Maximo Asset Num",
        "Maximo Serial No",
        "Open Qty - Reservation",
        "Open Reservation Value",
        "Pegged Main PO GR Status",
        "Pegged Main PO Invoice Status",
        "Planned Order - Status",
        "Planned Orders",
        "Plant",
        "Post Pegging PO Qty",
        "Post Pegging SOH Qty",
        "Primary Pegged PO-LN - Approval Status",
        "Primary Pegged PO-LN - Invoice Qty",
        "Primary Pegged PO-LN - Open Qty",
        "Primary Pegged PO-LN - Order Qty",
        "Primary Pegged PO-LN - RDD Date",
        "Purchase Requisition - Status",
        "Purchase Requisitions",
        "Requirements Date",
        "Reservation -Line",
        "Reservation Creation type",
        "Stock On Hand - DDSC",
        "Stock On Hand - HDSC",
        "Sub - Business Line - By Cost Center",
        "User Name",
        "WBS Element",
        "WO Number",
        "reservation_line_id",
        "reservation_line_number",
        "reservation_number"
      ],
      "dtypes": {
        "Additional PO - Line to Peg": "object",
        "Business Line - By Cost Center": "object",
        "Business Line by Profit Center": "object",
        "Combined SOH & PO Pegging": "object",
        "Cost Center": "object",
        "Creation Date": "object",
        "GEO UNIT (Profit Center)": "object",
        "Geo-Unit": "object",
        "Goods recipient": "object",
        "Index": "object",
        "Last 12 Month Consumption": "float64",
        "Last 3 Month Consumption": "float64",
        "Last 6 Month Consumption": "float64",
        "MRP Parameters - MRP Controller": "object",
        "MRP Parameters - Planned Delivery Time": "float64",
        "MRP Parameters - Prime Status": "object",
        "MRP Parameters - Profit Center": "float64",
        "MRP Parameters - Safety Stock": "float64",
        "MRP Parameters - Standard Price": "float64",
        "Main - PO Line to Peg to Reservation": "object",
        "Main - PO to Peg to Reservation": "float64",
        "Material": "object",
        "Material Description": "object",
        "Material Stratification (Last 12 Month Consumption)": "object",
        "Material Stratification (Last 6 Month Consumption)": "object",
        "Material-Plant": "object",
        "Material/Plant-Open PO Qty - Total": "float64",
        "Material/Plant-SOH - Total": "float64",
        "Maximo - WO STATUS and Part Status": "object",
        "Maximo Asset ID": "float64",
        "Maximo Asset Num": "object",
        "Maximo Serial No": "object",
        "Open Qty - Reservation": "float64",
        "Open Reservation Value": "float64",
        "Pegged Main PO GR Status": "object",
        "Pegged Main PO Invoice Status": "object",
        "Planned Order - Status": "object",
        "Planned Orders": "object",
        "Plant": "float64",
        "Post Pegging PO Qty": "float64",
        "Post Pegging SOH Qty": "float64",
        "Primary Pegged PO-LN - Approval Status": "object",
        "Primary Pegged PO-LN - Invoice Qty": "float64",
        "Primary Pegged PO-LN - Open Qty": "float64",
        "Primary Pegged PO-LN - Order Qty": "float64",
        "Primary Pegged PO-LN - RDD Date": "object",
        "Purchase Requisition - Status": "object",
        "Purchase Requisitions": "float64",
        "Requirements Date": "object",
        "Reservation -Line": "object",
        "Reservation Creation type": "object",
        "Stock On Hand - DDSC": "float64",
        "Stock On Hand - HDSC": "float64",
        "Sub - Business Line - By Cost Center": "object",
        "User Name": "object",
        "WBS Element": "object",
        "WO Number": "object",
        "reservation_line_id": "object",
        "reservation_line_number": "float64",
        "reservation_number": "float64"
      },
      "null_counts": {
        "Additional PO - Line to Peg": 1553,
        "Business Line - By Cost Center": 361,
        "Business Line by Profit Center": 2,
        "Combined SOH & PO Pegging": 2,
        "Cost Center": 361,
        "Creation Date": 2,
        "GEO UNIT (Profit Center)": 2,
        "Geo-Unit": 2,
        "Goods recipient": 16,
        "Index": 1,
        "Last 12 Month Consumption": 2,
        "Last 3 Month Consumption": 2,
        "Last 6 Month Consumption": 2,
        "MRP Parameters - MRP Controller": 2,
        "MRP Parameters - Planned Delivery Time": 2,
        "MRP Parameters - Prime Status": 2,
        "MRP Parameters - Profit Center": 2,
        "MRP Parameters - Safety Stock": 2,
        "MRP Parameters - Standard Price": 2,
        "Main - PO Line to Peg to Reservation": 1022,
        "Main - PO to Peg to Reservation": 1022,
        "Material": 2,
        "Material Description": 2,
        "Material Stratification (Last 12 Month Consumption)": 2,
        "Material Stratification (Last 6 Month Consumption)": 2,
        "Material-Plant": 2,
        "Material/Plant-Open PO Qty - Total": 2,
        "Material/Plant-SOH - Total": 1096,
        "Maximo - WO STATUS and Part Status": 2,
        "Maximo Asset ID": 949,
        "Maximo Asset Num": 949,
        "Maximo Serial No": 949,
        "Open Qty - Reservation": 2,
        "Open Reservation Value": 2,
        "Pegged Main PO GR Status": 1022,
        "Pegged Main PO Invoice Status": 1022,
        "Planned Order - Status": 2,
        "Planned Orders": 1094,
        "Plant": 2,
        "Post Pegging PO Qty": 47,
        "Post Pegging SOH Qty": 2,
        "Primary Pegged PO-LN - Approval Status": 1073,
        "Primary Pegged PO-LN - Invoice Qty": 1533,
        "Primary Pegged PO-LN - Open Qty": 1073,
        "Primary Pegged PO-LN - Order Qty": 1073,
        "Primary Pegged PO-LN - RDD Date": 1073,
        "Purchase Requisition - Status": 2,
        "Purchase Requisitions": 1573,
        "Requirements Date": 2,
        "Reservation -Line": 2,
        "Reservation Creation type": 2,
        "Stock On Hand - DDSC": 761,
        "Stock On Hand - HDSC": 930,
        "Sub - Business Line - By Cost Center": 361,
        "User Name": 2,
        "WBS Element": 1217,
        "WO Number": 536,
        "reservation_line_id": 2,
        "reservation_line_number": 2,
        "reservation_number": 2
      },
      "path": "data/intermediate/reservations.csv",
      "row_count": 1576,
      "sample_row": {
        "Additional PO - Line to Peg": NaN,
        "Business Line - By Cost Center": "RPE",
        "Business Line by Profit Center": "RPE",
        "Combined SOH & PO Pegging": "05. No PO Available to Peg",
        "Cost Center": "AU100307",
        "Creation Date": "2025-12-19",
        "GEO UNIT (Profit Center)": "APG",
        "Geo-Unit": "APG",
        "Goods recipient": "00821967",
        "Index": "1",
        "Last 12 Month Consumption": 0.0,
        "Last 3 Month Consumption": 0.0,
        "Last 6 Month Consumption": 0.0,
        "MRP Parameters - MRP Controller": "ZZZ",
        "MRP Parameters - Planned Delivery Time": 999.0,
        "MRP Parameters - Prime Status": "Non AR Part",
        "MRP Parameters - Profit Center": 110516.0,
        "MRP Parameters - Safety Stock": 0.0,
        "MRP Parameters - Standard Price": 1035.15,
        "Main - PO Line to Peg to Reservation": NaN,
        "Main - PO to Peg to Reservation": NaN,
        "Material": "100984281",
        "Material Description": "MODEL, PWA, DEPTH/TENSION, EWAFE2.0",
        "Material Stratification (Last 12 Month Consumption)": "SLOW MOVER",
        "Material Stratification (Last 6 Month Consumption)": "SLOW MOVER",
        "Material-Plant": "100984281-3610",
        "Material/Plant-Open PO Qty - Total": 0.0,
        "Material/Plant-SOH - Total": NaN,
        "Maximo - WO STATUS and Part Status": "-",
        "Maximo Asset ID": NaN,
        "Maximo Asset Num": NaN,
        "Maximo Serial No": NaN,
        "Open Qty - Reservation": 1.0,
        "Open Reservation Value": 1000.0,
        "Pegged Main PO GR Status": NaN,
        "Pegged Main PO Invoice Status": NaN,
        "Planned Order - Status": "NO PLD ORDER",
        "Planned Orders": NaN,
        "Plant": 3610.0,
        "Post Pegging PO Qty": 0.0,
        "Post Pegging SOH Qty": -1.0,
        "Primary Pegged PO-LN - Approval Status": NaN,
        "Primary Pegged PO-LN - Invoice Qty": NaN,
        "Primary Pegged PO-LN - Open Qty": NaN,
        "Primary Pegged PO-LN - Order Qty": NaN,
        "Primary Pegged PO-LN - RDD Date": NaN,
        "Purchase Requisition - Status": "No Purchase Requisition",
        "Purchase Requisitions": NaN,
        "Requirements Date": "2026-01-09",
        "Reservation -Line": "6087563331-1",
        "Reservation Creation type": "MAXIMO",
        "Stock On Hand - DDSC": NaN,
        "Stock On Hand - HDSC": NaN,
        "Sub - Business Line - By Cost Center": "WLES",
        "User Name": "SYS-MAXIMO",
        "WBS Element": NaN,
        "WO Number": "1010265907",
        "reservation_line_id": "6087563331-1",
        "reservation_line_number": 1.0,
        "reservation_number": 6087563331.0
      }
    },
    "sap_reservations.csv": {
      "columns": [
        "asset_code",
        "asset_serial_number",
        "description",
        "open_reservation_qty",
        "open_reservation_value",
        "part_number",
        "plant_code",
        "po_line_item_id",
        "po_line_number",
        "po_number",
        "requester_alias",
        "reservation_creation_date",
        "reservation_line_id",
        "reservation_line_number",
        "reservation_number",
        "reservation_requirement_date",
        "reservation_source",
        "reservation_status",
        "wbs_number"
      ],
      "dtypes": {
        "asset_code": "object",
        "asset_serial_number": "object",
        "description": "object",
        "open_reservation_qty": "float64",
        "open_reservation_value": "float64",
        "part_number": "object",
        "plant_code": "int64",
        "po_line_item_id": "object",
        "po_line_number": "float64",
        "po_number": "float64",
        "requester_alias": "object",
        "reservation_creation_date": "object",
        "reservation_line_id": "object",
        "reservation_line_number": "int64",
        "reservation_number": "int64",
        "reservation_requirement_date": "object",
        "reservation_source": "object",
        "reservation_status": "object",
        "wbs_number": "object"
      },
      "null_counts": {
        "asset_code": 947,
        "asset_serial_number": 976,
        "po_line_item_id": 1020,
        "po_line_number": 1020,
        "po_number": 1020,
        "requester_alias": 14,
        "wbs_number": 1215
      },
      "path": "data/import-ready/sap_reservations.csv",
      "row_count": 1574,
      "sample_row": {
        "asset_code": NaN,
        "asset_serial_number": NaN,
        "description": "MODEL, PWA, DEPTH/TENSION, EWAFE2.0",
        "open_reservation_qty": 1.0,
        "open_reservation_value": 1000.0,
        "part_number": "100984281",
        "plant_code": 3610,
        "po_line_item_id": NaN,
        "po_line_number": NaN,
        "po_number": NaN,
        "requester_alias": "00821967",
        "reservation_creation_date": "2025-12-19",
        "reservation_line_id": "6087563331-1",
        "reservation_line_number": 1,
        "reservation_number": 6087563331,
        "reservation_requirement_date": "2026-01-09",
        "reservation_source": "MAXIMO",
        "reservation_status": "05. No PO Available to Peg",
        "wbs_number": NaN
      }
    },
    "unmatched_reservation_pos.csv": {
      "columns": [
        "asset_code",
        "asset_serial_number",
        "description",
        "open_reservation_qty",
        "open_reservation_value",
        "part_number",
        "plant_code",
        "po_line_item_id",
        "po_line_number",
        "po_number",
        "requester_alias",
        "reservation_creation_date",
        "reservation_line_id",
        "reservation_line_number",
        "reservation_number",
        "reservation_requirement_date",
        "reservation_source",
        "reservation_status",
        "wbs_number"
      ],
      "dtypes": {
        "asset_code": "object",
        "asset_serial_number": "float64",
        "description": "object",
        "open_reservation_qty": "float64",
        "open_reservation_value": "float64",
        "part_number": "object",
        "plant_code": "int64",
        "po_line_item_id": "object",
        "po_line_number": "float64",
        "po_number": "float64",
        "requester_alias": "object",
        "reservation_creation_date": "object",
        "reservation_line_id": "object",
        "reservation_line_number": "int64",
        "reservation_number": "int64",
        "reservation_requirement_date": "object",
        "reservation_source": "object",
        "reservation_status": "object",
        "wbs_number": "object"
      },
      "null_counts": {
        "asset_code": 28,
        "asset_serial_number": 28,
        "wbs_number": 19
      },
      "path": "data/intermediate/unmatched_reservation_pos.csv",
      "row_count": 30,
      "sample_row": {
        "asset_code": NaN,
        "asset_serial_number": NaN,
        "description": "HOUSING, POWER UNIT",
        "open_reservation_qty": 1.0,
        "open_reservation_value": 3542.4207,
        "part_number": "J971840",
        "plant_code": 3606,
        "po_line_item_id": "4584632535-1",
        "po_line_number": 1.0,
        "po_number": 4584632535.0,
        "requester_alias": "02307312",
        "reservation_creation_date": "2025-11-24",
        "reservation_line_id": "6086214878-2",
        "reservation_line_number": 2,
        "reservation_number": 6086214878,
        "reservation_requirement_date": "2025-11-25",
        "reservation_source": "MAXIMO",
        "reservation_status": "04. PO Available to Peg",
        "wbs_number": NaN
      }
    },
    "wbs_details.csv": {
      "columns": [
        "client_name",
        "location",
        "operation_number",
        "ops_activity_number",
        "ops_district",
        "project_number",
        "rig",
        "sub_business_lines",
        "wbs_name",
        "wbs_number",
        "wbs_source"
      ],
      "dtypes": {
        "client_name": "object",
        "location": "object",
        "operation_number": "object",
        "ops_activity_number": "object",
        "ops_district": "object",
        "project_number": "object",
        "rig": "object",
        "sub_business_lines": "object",
        "wbs_name": "object",
        "wbs_number": "object",
        "wbs_source": "object"
      },
      "null_counts": {
        "operation_number": 526,
        "ops_activity_number": 670,
        "rig": 232
      },
      "path": "data/import-ready/wbs_details.csv",
      "row_count": 7852,
      "sample_row": {
        "client_name": "SANTOS LIMITED",
        "location": "Moomba",
        "operation_number": NaN,
        "ops_activity_number": NaN,
        "ops_district": "Moomba WL",
        "project_number": "P.1033291",
        "rig": "RIGLESS - AUSTRALIA",
        "sub_business_lines": "{SLKN}",
        "wbs_name": "Q3 U420 Rigless",
        "wbs_number": "J.22.111697",
        "wbs_source": "Project"
      }
    },
    "wbs_from_operations.csv": {
      "columns": [
        "client_name",
        "location",
        "operation_number",
        "ops_activity_number",
        "ops_district",
        "project_number",
        "rig",
        "sap_wbs_raw",
        "sub_business_lines_raw",
        "wbs_name",
        "wbs_source"
      ],
      "dtypes": {
        "client_name": "object",
        "location": "float64",
        "operation_number": "object",
        "ops_activity_number": "float64",
        "ops_district": "object",
        "project_number": "object",
        "rig": "object",
        "sap_wbs_raw": "object",
        "sub_business_lines_raw": "object",
        "wbs_name": "object",
        "wbs_source": "object"
      },
      "null_counts": {
        "location": 144,
        "ops_activity_number": 144,
        "rig": 10
      },
      "path": "data/intermediate/wbs_from_operations.csv",
      "row_count": 144,
      "sample_row": {
        "client_name": "FUGRO AUSTRALIA PTY LTD",
        "location": NaN,
        "operation_number": "O.1075365.01",
        "ops_activity_number": NaN,
        "ops_district": "APG TS",
        "project_number": "P.1075365",
        "rig": NaN,
        "sap_wbs_raw": "J.25.166462",
        "sub_business_lines_raw": "DHT",
        "wbs_name": "Fugro Subsea Sampling Job",
        "wbs_source": "Operation"
      }
    },
    "wbs_from_ops_activities.csv": {
      "columns": [
        "client_name",
        "location",
        "operation_number",
        "ops_activity_number",
        "ops_district",
        "project_number",
        "rig",
        "sap_wbs_raw",
        "sub_business_line_raw",
        "wbs_name",
        "wbs_source"
      ],
      "dtypes": {
        "client_name": "object",
        "location": "float64",
        "operation_number": "object",
        "ops_activity_number": "object",
        "ops_district": "object",
        "project_number": "object",
        "rig": "object",
        "sap_wbs_raw": "object",
        "sub_business_line_raw": "object",
        "wbs_name": "object",
        "wbs_source": "object"
      },
      "null_counts": {
        "location": 7182,
        "rig": 222
      },
      "path": "data/intermediate/wbs_from_ops_activities.csv",
      "row_count": 7182,
      "sample_row": {
        "client_name": "ORIGIN ENERGY UPSTREAM OPERATOR PTY LTD",
        "location": NaN,
        "operation_number": "O.1077724.01",
        "ops_activity_number": "A.1077724.01.05",
        "ops_district": "AUS East Coast WS",
        "project_number": "P.1077724",
        "rig": NaN,
        "sap_wbs_raw": "J.26.019759",
        "sub_business_line_raw": "WS Production Services",
        "wbs_name": "ShaleAID test5",
        "wbs_source": "Operation Activity"
      }
    },
    "wbs_from_projects.csv": {
      "columns": [
        "client_name",
        "location",
        "operation_number",
        "ops_activity_number",
        "ops_district",
        "project_number",
        "rig",
        "sap_wbs_raw",
        "wbs_name",
        "wbs_source"
      ],
      "dtypes": {
        "client_name": "object",
        "location": "object",
        "operation_number": "float64",
        "ops_activity_number": "float64",
        "ops_district": "object",
        "project_number": "object",
        "rig": "object",
        "sap_wbs_raw": "object",
        "wbs_name": "object",
        "wbs_source": "object"
      },
      "null_counts": {
        "operation_number": 369,
        "ops_activity_number": 369
      },
      "path": "data/intermediate/wbs_from_projects.csv",
      "row_count": 369,
      "sample_row": {
        "client_name": "SANTOS LIMITED",
        "location": "Moomba",
        "operation_number": NaN,
        "ops_activity_number": NaN,
        "ops_district": "Moomba WL",
        "project_number": "P.1033291",
        "rig": "RIGLESS - AUSTRALIA",
        "sap_wbs_raw": "J.22.111697(SLKN), J.22.153401(WLPS)",
        "wbs_name": "Q3 U420 Rigless",
        "wbs_source": "Project"
      }
    },
    "wbs_processed.csv": {
      "columns": [
        "client_name",
        "location",
        "operation_number",
        "ops_activity_number",
        "ops_district",
        "project_number",
        "rig",
        "sub_business_lines",
        "wbs_name",
        "wbs_number",
        "wbs_source"
      ],
      "dtypes": {
        "client_name": "object",
        "location": "object",
        "operation_number": "object",
        "ops_activity_number": "object",
        "ops_district": "object",
        "project_number": "object",
        "rig": "object",
        "sub_business_lines": "object",
        "wbs_name": "object",
        "wbs_number": "object",
        "wbs_source": "object"
      },
      "null_counts": {
        "operation_number": 526,
        "ops_activity_number": 670,
        "rig": 232
      },
      "path": "data/intermediate/wbs_processed.csv",
      "row_count": 7852,
      "sample_row": {
        "client_name": "SANTOS LIMITED",
        "location": "Moomba",
        "operation_number": NaN,
        "ops_activity_number": NaN,
        "ops_district": "Moomba WL",
        "project_number": "P.1033291",
        "rig": "RIGLESS - AUSTRALIA",
        "sub_business_lines": "[\"SLKN\"]",
        "wbs_name": "Q3 U420 Rigless",
        "wbs_number": "J.22.111697",
        "wbs_source": "Project"
      }
    }
  },
  "description": "Data pipeline for transforming raw PO/GR/IR data into import-ready CSVs",
  "execution_order": [
    "01_po_line_items",
    "02_gr_postings",
    "03_ir_postings",
    "04_enrich_po_line_items",
    "05_calculate_cost_impact",
    "06_prepare_po_line_items",
    "07_prepare_po_transactions"
  ],
  "generated_at": "2026-02-16T12:06:50.218591+00:00",
  "key_files": {
    "column_config": "scripts/config/column_mappings.py",
    "orchestrator": "scripts/pipeline.py",
    "schema_dir": "src/schema/"
  },
  "pipeline_stages": [
    {
      "description": "Clean and filter raw data",
      "input_folder": "data/raw",
      "name": "stage1_clean",
      "output_folder": "data/intermediate"
    },
    {
      "description": "Enrich data and calculate derived values",
      "input_folder": "data/intermediate",
      "name": "stage2_transform",
      "output_folder": "data/intermediate"
    },
    {
      "description": "Map columns to database schema",
      "input_folder": "data/intermediate",
      "name": "stage3_prepare",
      "output_folder": "data/import-ready"
    }
  ],
  "project": "cost-management-db",
  "schema_tables": [
    {
      "columns": [
        {
          "has_default": true,
          "name": "accessCount",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "content",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "contentHash",
          "type": "varchar"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "embedding",
          "type": "unknown"
        },
        {
          "has_default": true,
          "name": "entities",
          "type": "jsonb"
        },
        {
          "has_default": true,
          "name": "event",
          "type": "varchar"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "has_default": true,
          "name": "importance",
          "not_null": true,
          "type": "real"
        },
        {
          "has_default": true,
          "name": "keywords",
          "type": "jsonb"
        },
        {
          "name": "lastAccessedAt",
          "type": "timestamp"
        },
        {
          "has_default": true,
          "name": "memoryType",
          "not_null": true,
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "metadata",
          "type": "jsonb"
        },
        {
          "name": "previousVersionId",
          "type": "uuid"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        },
        {
          "name": "userId",
          "not_null": true,
          "references": "users.id",
          "type": "uuid"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "agent-memories.ts",
      "name": "agent_memories"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "event",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "memoryId",
          "not_null": true,
          "references": "agentMemories.id",
          "type": "uuid"
        },
        {
          "name": "newContent",
          "type": "text"
        },
        {
          "name": "oldContent",
          "type": "text"
        },
        {
          "name": "reason",
          "type": "text"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "agent-memories.ts",
      "name": "agent_memory_history"
    },
    {
      "columns": [
        {
          "name": "costBreakdownId",
          "not_null": true,
          "references": "costBreakdown.id",
          "type": "uuid"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "forecastVersionId",
          "not_null": true,
          "references": "forecastVersions.id",
          "type": "uuid"
        },
        {
          "has_default": true,
          "name": "forecastedCost",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "budget-forecasts.ts",
      "name": "budget_forecasts"
    },
    {
      "columns": [
        {
          "has_default": true,
          "name": "budgetCost",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "costLine",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "projectId",
          "not_null": true,
          "references": "projects.id",
          "type": "uuid"
        },
        {
          "name": "spendSubCategory",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "spendType",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "cost-breakdown.ts",
      "name": "cost_breakdown"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "has_default": true,
          "name": "createdBy",
          "type": "text"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "projectId",
          "not_null": true,
          "references": "projects.id",
          "type": "uuid"
        },
        {
          "name": "reasonForChange",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "versionNumber",
          "not_null": true,
          "type": "integer"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "forecast-versions.ts",
      "name": "forecast_versions"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "has_default": true,
          "name": "daysOpen",
          "type": "integer"
        },
        {
          "name": "firstExposureDate",
          "type": "date"
        },
        {
          "has_default": true,
          "name": "grirQty",
          "not_null": true,
          "type": "numeric"
        },
        {
          "has_default": true,
          "name": "grirValue",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "poLineItemId",
          "not_null": true,
          "references": "poLineItems.id",
          "type": "uuid"
        },
        {
          "name": "snapshotDate",
          "not_null": true,
          "type": "date"
        },
        {
          "name": "timeBucket",
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "grir-exposures.ts",
      "name": "grir_exposures"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "createdBy",
          "references": "users.id",
          "type": "uuid"
        },
        {
          "name": "email",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "expiresAt",
          "not_null": true,
          "type": "timestamp"
        },
        {
          "has_default": true,
          "name": "failedAttempts",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "pinHash",
          "not_null": true,
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "used",
          "type": "boolean"
        },
        {
          "name": "usedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "pending-invites.ts",
      "name": "pending_invites"
    },
    {
      "columns": [
        {
          "name": "accountAssignmentCategory",
          "type": "varchar"
        },
        {
          "name": "assetCode",
          "type": "varchar"
        },
        {
          "name": "costImpactPct",
          "type": "numeric"
        },
        {
          "name": "costImpactValue",
          "type": "numeric"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "description",
          "type": "text"
        },
        {
          "name": "expectedDeliveryDate",
          "type": "date"
        },
        {
          "has_default": true,
          "name": "fmtPo",
          "not_null": true,
          "type": "boolean"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "has_default": true,
          "name": "isActive",
          "not_null": true,
          "type": "boolean"
        },
        {
          "has_default": true,
          "name": "isCapex",
          "type": "boolean"
        },
        {
          "name": "lineItemNumber",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "location",
          "type": "varchar"
        },
        {
          "name": "nisLine",
          "type": "varchar"
        },
        {
          "name": "openPoQty",
          "type": "numeric"
        },
        {
          "name": "openPoValue",
          "type": "numeric"
        },
        {
          "name": "orderUnit",
          "type": "varchar"
        },
        {
          "name": "orderedQty",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "partNumber",
          "type": "varchar"
        },
        {
          "name": "plantCode",
          "type": "varchar"
        },
        {
          "name": "poApprovalStatus",
          "type": "varchar"
        },
        {
          "name": "poCreationDate",
          "type": "date"
        },
        {
          "name": "poGtsStatus",
          "type": "varchar"
        },
        {
          "name": "poLineId",
          "not_null": true,
          "type": "varchar",
          "unique": true
        },
        {
          "name": "poNumber",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "poReceiptStatus",
          "type": "varchar"
        },
        {
          "name": "poValueUsd",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "prLine",
          "type": "integer"
        },
        {
          "name": "prNumber",
          "type": "varchar"
        },
        {
          "name": "requester",
          "type": "varchar"
        },
        {
          "name": "subBusinessLine",
          "type": "varchar"
        },
        {
          "name": "ultimateVendorName",
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        },
        {
          "name": "vendorCategory",
          "type": "varchar"
        },
        {
          "name": "vendorId",
          "type": "varchar"
        },
        {
          "name": "vendorName",
          "type": "varchar"
        },
        {
          "name": "wbsNumber",
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "wbsValidated",
          "type": "boolean"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "po-line-items.ts",
      "name": "po_line_items"
    },
    {
      "columns": [
        {
          "name": "confirmedAt",
          "type": "timestamp"
        },
        {
          "name": "confirmedBy",
          "type": "varchar"
        },
        {
          "name": "costBreakdownId",
          "not_null": true,
          "references": "costBreakdown.id",
          "type": "uuid"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "mappedAmount",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "mappedAt",
          "type": "timestamp"
        },
        {
          "name": "mappedBy",
          "type": "varchar"
        },
        {
          "name": "mappingNotes",
          "type": "text"
        },
        {
          "has_default": true,
          "name": "mappingSource",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "poLineItemId",
          "not_null": true,
          "references": "poLineItems.id",
          "type": "uuid"
        },
        {
          "has_default": true,
          "name": "requiresConfirmation",
          "not_null": true,
          "type": "boolean"
        },
        {
          "name": "sourcePrPreMappingId",
          "references": "prPreMappings.id",
          "type": "uuid"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "po-mappings.ts",
      "name": "po_mappings"
    },
    {
      "columns": [
        {
          "name": "approvedAt",
          "type": "timestamp"
        },
        {
          "name": "approvedBy",
          "type": "varchar"
        },
        {
          "name": "completedAt",
          "type": "timestamp"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "newValue",
          "type": "jsonb"
        },
        {
          "name": "notes",
          "type": "text"
        },
        {
          "name": "oldValue",
          "type": "jsonb"
        },
        {
          "name": "operationType",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "poLineItemId",
          "not_null": true,
          "references": "poLineItems.id",
          "type": "uuid"
        },
        {
          "name": "reason",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "requestedAt",
          "not_null": true,
          "type": "timestamp"
        },
        {
          "name": "requestedBy",
          "not_null": true,
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "status",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "po-operations.ts",
      "name": "po_operations"
    },
    {
      "columns": [
        {
          "has_default": true,
          "name": "amount",
          "not_null": true,
          "type": "numeric"
        },
        {
          "has_default": true,
          "name": "costImpactAmount",
          "not_null": true,
          "type": "numeric"
        },
        {
          "has_default": true,
          "name": "costImpactQty",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "poLineItemId",
          "not_null": true,
          "references": "poLineItems.id",
          "type": "uuid"
        },
        {
          "name": "postingDate",
          "not_null": true,
          "type": "date"
        },
        {
          "has_default": true,
          "name": "quantity",
          "not_null": true,
          "type": "numeric"
        },
        {
          "name": "transactionId",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "transactionType",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "po-transactions.ts",
      "name": "po_transactions"
    },
    {
      "columns": [
        {
          "name": "closedAt",
          "type": "timestamp"
        },
        {
          "name": "closedBy",
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "confirmedCount",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "costBreakdownId",
          "not_null": true,
          "references": "costBreakdown.id",
          "type": "uuid"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "createdBy",
          "type": "varchar"
        },
        {
          "name": "expiresAt",
          "not_null": true,
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "notes",
          "type": "text"
        },
        {
          "has_default": true,
          "name": "pendingConfirmationCount",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "prLine",
          "type": "integer"
        },
        {
          "name": "prNumber",
          "not_null": true,
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "status",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "pr-pre-mappings.ts",
      "name": "pr_pre_mappings"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "name",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "subBusinessLine",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "projects.ts",
      "name": "projects"
    },
    {
      "columns": [
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "deviceBindingChallenge",
          "type": "varchar"
        },
        {
          "has_default": true,
          "name": "deviceBindingVerified",
          "type": "boolean"
        },
        {
          "name": "deviceCredentialId",
          "type": "text"
        },
        {
          "name": "devicePublicKey",
          "type": "text"
        },
        {
          "name": "email",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "expiresAt",
          "not_null": true,
          "type": "timestamp"
        },
        {
          "name": "tokenHash",
          "primary_key": true,
          "type": "unknown"
        },
        {
          "has_default": true,
          "name": "used",
          "type": "boolean"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "registration-attempts.ts",
      "name": "registration_attempts"
    },
    {
      "columns": [
        {
          "name": "additionalInfo",
          "type": "jsonb"
        },
        {
          "name": "attemptType",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "email",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "ipHash",
          "type": "unknown"
        },
        {
          "name": "userAgent",
          "type": "varchar"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "registration-audit-log.ts",
      "name": "registration_audit_log"
    },
    {
      "columns": [
        {
          "name": "assetCode",
          "type": "varchar"
        },
        {
          "name": "assetSerialNumber",
          "type": "varchar"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "description",
          "type": "text"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "openReservationQty",
          "type": "numeric"
        },
        {
          "name": "openReservationValue",
          "type": "numeric"
        },
        {
          "name": "partNumber",
          "type": "varchar"
        },
        {
          "name": "plantCode",
          "type": "varchar"
        },
        {
          "name": "poLineItemId",
          "type": "varchar"
        },
        {
          "name": "poLineNumber",
          "type": "integer"
        },
        {
          "name": "poNumber",
          "type": "varchar"
        },
        {
          "name": "requesterAlias",
          "type": "varchar"
        },
        {
          "name": "reservationCreationDate",
          "type": "date"
        },
        {
          "name": "reservationLineId",
          "not_null": true,
          "type": "varchar",
          "unique": true
        },
        {
          "name": "reservationLineNumber",
          "not_null": true,
          "type": "integer"
        },
        {
          "name": "reservationNumber",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "reservationRequirementDate",
          "type": "date"
        },
        {
          "name": "reservationSource",
          "type": "varchar"
        },
        {
          "name": "reservationStatus",
          "type": "varchar"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        },
        {
          "name": "wbsNumber",
          "type": "varchar"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "sap-reservations.ts",
      "name": "sap_reservations"
    },
    {
      "columns": [
        {
          "name": "backupCodes",
          "type": "text"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "email",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "has_default": true,
          "name": "isActive",
          "type": "boolean"
        },
        {
          "name": "lastLoginAt",
          "type": "timestamp"
        },
        {
          "name": "totpSecret",
          "type": "varchar"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "users.ts",
      "name": "users"
    },
    {
      "columns": [
        {
          "name": "clientName",
          "type": "text"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "location",
          "type": "varchar"
        },
        {
          "name": "operationNumber",
          "type": "varchar"
        },
        {
          "name": "opsActivityNumber",
          "type": "varchar"
        },
        {
          "name": "opsDistrict",
          "type": "varchar"
        },
        {
          "name": "projectNumber",
          "type": "varchar"
        },
        {
          "name": "rig",
          "type": "varchar"
        },
        {
          "name": "subBusinessLines",
          "type": "text"
        },
        {
          "name": "updatedAt",
          "type": "timestamp"
        },
        {
          "name": "wbsName",
          "type": "text"
        },
        {
          "name": "wbsNumber",
          "primary_key": true,
          "type": "varchar"
        },
        {
          "name": "wbsSource",
          "not_null": true,
          "type": "varchar"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "wbs-details.ts",
      "name": "wbs_details"
    },
    {
      "columns": [
        {
          "name": "challenge",
          "primary_key": true,
          "type": "text"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "email",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "expiresAt",
          "not_null": true,
          "type": "timestamp"
        },
        {
          "name": "type",
          "not_null": true,
          "type": "varchar"
        },
        {
          "name": "userId",
          "type": "text"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "webauthn-challenges.ts",
      "name": "webauthn_challenges"
    },
    {
      "columns": [
        {
          "has_default": true,
          "name": "backedUp",
          "type": "boolean"
        },
        {
          "has_default": true,
          "name": "counter",
          "not_null": true,
          "type": "bigint"
        },
        {
          "name": "createdAt",
          "type": "timestamp"
        },
        {
          "name": "credentialId",
          "not_null": true,
          "type": "text",
          "unique": true
        },
        {
          "name": "deviceName",
          "type": "varchar"
        },
        {
          "name": "deviceType",
          "type": "varchar"
        },
        {
          "name": "id",
          "primary_key": true,
          "type": "uuid"
        },
        {
          "name": "lastUsedAt",
          "type": "timestamp"
        },
        {
          "name": "publicKey",
          "not_null": true,
          "type": "text"
        },
        {
          "name": "transports",
          "type": "text"
        },
        {
          "name": "userId",
          "not_null": true,
          "references": "users.id",
          "type": "uuid"
        }
      ],
      "extraction_method": "ts-ast",
      "file": "webauthn-credentials.ts",
      "name": "webauthn_credentials"
    }
  ],
  "scripts": [
    {
      "dependencies": [
        "06_prepare_po_line_items"
      ],
      "docstring": "Stage 1: Clean PO Line Items\n\nReads raw PO line items CSV, applies filtering and transformations,\noutputs to intermediate folder.\n\nDependencies: None (first script in pipeline)\nInput: data/raw/po line items.csv\nOutput: data/intermediate/po_line_items.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Consolidate delivery date columns into 'Expected Delivery Date'.",
          "line": 109,
          "name": "consolidate_delivery_dates",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "Expected Delivery Date"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Set NIS Level 0 Desc to 'Materials and Supplies' for Valuation Class 3021 where null.",
          "line": 63,
          "name": "fill_nis_level_for_3021",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Remove rows with excluded NIS Level 0 Desc values.",
          "line": 53,
          "name": "filter_nis_levels",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Remove rows with excluded PO Valuation Classes.",
          "line": 42,
          "name": "filter_valuation_classes",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the raw CSV file.",
          "line": 34,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 135,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map Plant Code to Location.",
          "line": 100,
          "name": "map_location",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "Location"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map Main Vendor Name and Ultimate Vendor Name based on vendor IDs.",
          "line": 85,
          "name": "map_vendor_names",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 125,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Rename NIS Level 0 Desc to NIS Line and clean up values.",
          "line": 73,
          "name": "transform_nis_column",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": true,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/po_line_items.csv",
        "data/raw/po line items.csv"
      ],
      "line_count": 175,
      "name": "01_po_line_items",
      "outputs": [
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "plant_code_str = df[\"Plant Code\"].astype(str)",
          "description": "Converts column types",
          "line": 102,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"Expected Delivery Date\"] = df[promised_col].where(",
          "column": "Expected Delivery Date",
          "description": "Creates/modifies column 'Expected Delivery Date'",
          "line": 114,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"Location\"] = plant_code_str.map(PLANT_CODE_TO_LOCATION)",
          "column": "Location",
          "description": "Creates/modifies column 'Location'",
          "line": 103,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.drop(columns=[requested_col, promised_col])",
          "description": "Removes columns or rows",
          "line": 120,
          "operation": "drop"
        },
        {
          "code_snippet": "df[\"Location\"] = plant_code_str.map(PLANT_CODE_TO_LOCATION)",
          "description": "Maps values using dictionary or function",
          "line": 103,
          "operation": "map"
        },
        {
          "code_snippet": "df.loc[main_mask, \"Main Vendor Name\"] = df.loc[main_mask, \"Main Vendor ID\"].map(VENDOR_NAME_MAPPING)",
          "description": "Maps values using dictionary or function",
          "line": 89,
          "operation": "map"
        },
        {
          "code_snippet": "df.loc[ultimate_mask, \"Ultimate Vendor Name\"] = df.loc[ultimate_mask, \"Ultimate Vendor Number\"].map(VENDOR_NAME_MAPPING)",
          "description": "Maps values using dictionary or function",
          "line": 94,
          "operation": "map"
        },
        {
          "code_snippet": "df = df.rename(columns={\"NIS Level 0 Desc\": \"NIS Line\"})",
          "column_renames": {
            "NIS Level 0 Desc": "NIS Line"
          },
          "description": "Renames columns",
          "line": 81,
          "operation": "rename"
        },
        {
          "code_snippet": "df = df.sort_values(\"PO Line ID\").reset_index(drop=True)",
          "description": "Sorts by column values",
          "line": 129,
          "operation": "sort_values"
        }
      ],
      "path": "scripts/stage1_clean/01_po_line_items.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [
        "06_calculate_grir",
        "06_prepare_po_line_items"
      ],
      "docstring": "Stage 1: Clean GR (Goods Receipt) Postings\n\nReads raw GR table, filters and calculates GR amounts using unit prices\nfrom intermediate PO line items.\n\nDependencies: 01_po_line_items.py must run first\nInput: data/raw/gr table.csv, data/intermediate/po_line_items.csv\nOutput: data/intermediate/gr_postings.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Calculate GR Amount based on unit price from PO Line Items.\nFormula: GR Amount = (Purchase Value USD / Ordered Quantity) * GR Effective Quantity",
          "line": 43,
          "name": "calculate_gr_amount",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": true,
            "modifies_columns": [
              "GR Amount",
              "Unit Price"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Remove rows with zero GR Effective Quantity.",
          "line": 34,
          "name": "filter_zero_quantity",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the raw CSV file.",
          "line": 26,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 80,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 72,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/gr_postings.csv",
        "data/intermediate/po_line_items.csv",
        "data/raw/gr table.csv"
      ],
      "line_count": 111,
      "name": "02_gr_postings",
      "outputs": [
        "data/intermediate/gr_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "df[\"GR Amount\"] = (df[\"Unit Price\"] * df[\"GR Effective Quantity\"]).round(2)",
          "column": "GR Amount",
          "description": "Creates/modifies column 'GR Amount'",
          "line": 64,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df[\"Unit Price\"] = po_df[\"Purchase Value USD\"] / po_df[\"Ordered Quantity\"]",
          "column": "Unit Price",
          "description": "Creates/modifies column 'Unit Price'",
          "line": 53,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.merge(unit_price_lookup, on=\"PO Line ID\", how=\"inner\")",
          "description": "Joins two DataFrames",
          "join_type": "inner",
          "line": 59,
          "on_column": "PO Line ID",
          "operation": "merge"
        }
      ],
      "path": "scripts/stage1_clean/02_gr_postings.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [
        "06_calculate_grir",
        "06_prepare_po_line_items"
      ],
      "docstring": "Stage 1: Clean IR (Invoice Receipt) Postings\n\nReads raw invoice table, calculates invoice amounts using unit prices\nfrom intermediate PO line items.\n\nDependencies: 01_po_line_items.py must run first\nInput: data/raw/invoice table.csv, data/intermediate/po_line_items.csv\nOutput: data/intermediate/ir_postings.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Calculate Invoice Amount based on unit price from PO Line Items.\nFormula: Invoice Amount = (Purchase Value USD / Ordered Quantity) * IR Effective Quantity",
          "line": 34,
          "name": "calculate_invoice_amount",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": true,
            "modifies_columns": [
              "Invoice Amount",
              "Unit Price"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the raw CSV file.",
          "line": 26,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 71,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 63,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv",
        "data/raw/invoice table.csv"
      ],
      "line_count": 99,
      "name": "03_ir_postings",
      "outputs": [
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "df[\"Invoice Amount\"] = (df[\"Unit Price\"] * df[\"IR Effective Quantity\"]).round(2)",
          "column": "Invoice Amount",
          "description": "Creates/modifies column 'Invoice Amount'",
          "line": 55,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df[\"Unit Price\"] = po_df[\"Purchase Value USD\"] / po_df[\"Ordered Quantity\"]",
          "column": "Unit Price",
          "description": "Creates/modifies column 'Unit Price'",
          "line": 44,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.merge(unit_price_lookup, on=\"PO Line ID\", how=\"inner\")",
          "description": "Joins two DataFrames",
          "join_type": "inner",
          "line": 50,
          "on_column": "PO Line ID",
          "operation": "merge"
        }
      ],
      "path": "scripts/stage1_clean/03_ir_postings.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [
        "06_prepare_po_line_items"
      ],
      "docstring": "Stage 2: Enrich PO Line Items\n\nEnriches intermediate PO line items with PR Number and Requester\nfrom the PO Details Report.\n\nDependencies: 01_po_line_items.py must run first\nInput: data/intermediate/po_line_items.csv, data/raw/po details report.xlsx\nOutput: data/intermediate/po_line_items.csv (updated in place)\n\nCaching: Extracts enrichment data from xlsx to CSV cache. Only reprocesses\nxlsx if the source file is newer than the cache.",
      "functions": [
        {
          "args": [
            "enrichment",
            "po_df"
          ],
          "docstring": "Left join enrichment data to PO line items.",
          "line": 112,
          "name": "enrich_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": true,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "details"
          ],
          "docstring": "Extract Requester, PR Number, and PR Line from PO Details.",
          "line": 78,
          "name": "extract_enrichment_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "PO Line ID",
              "PR Line",
              "PR Number",
              "Requester"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [],
          "docstring": "Check if enrichment cache exists and is newer than the xlsx source.",
          "line": 30,
          "name": "is_cache_fresh",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load enrichment data from cache CSV.",
          "line": 43,
          "name": "load_enrichment_from_cache",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load PO Details Report and prepare for join.",
          "line": 57,
          "name": "load_po_details",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "PO Line ID",
              "PO Line Item"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load intermediate PO line items.",
          "line": 70,
          "name": "load_po_line_items",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 163,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save enriched DataFrame to CSV.",
          "line": 154,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "enrichment"
          ],
          "docstring": "Save enrichment data to cache CSV for future runs.",
          "line": 51,
          "name": "save_enrichment_to_cache",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/po_details_enrichment.csv",
        "data/intermediate/po_line_items.csv",
        "data/raw/po details report.xlsx"
      ],
      "line_count": 203,
      "name": "04_enrich_po_line_items",
      "outputs": [
        "data/intermediate/po_details_enrichment.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "pr_number = pr_number.apply(lambda x: str(int(x)) if pd.notna(x) else None)",
          "description": "Applies function to data",
          "line": 93,
          "operation": "apply"
        },
        {
          "code_snippet": "ariba_number = ariba_number.apply(lambda x: str(x) if pd.notna(x) else None)",
          "description": "Applies function to data",
          "line": 94,
          "operation": "apply"
        },
        {
          "code_snippet": "enrichment['PR Line'] = pd.to_numeric(",
          "description": "Converts column types",
          "line": 100,
          "operation": "astype"
        },
        {
          "code_snippet": "pr_str = enriched['PR Number'].astype(str)",
          "description": "Converts column types",
          "line": 134,
          "operation": "astype"
        },
        {
          "code_snippet": "df['PO Line Item'] = df['PO Line Item'].fillna(0).astype(int)",
          "description": "Converts column types",
          "line": 64,
          "operation": "astype"
        },
        {
          "code_snippet": "df['PO Line ID'] = df['PO Number'].astype(str) + '-' + df['PO Line Item'].astype(str)",
          "description": "Converts column types",
          "line": 65,
          "operation": "astype"
        },
        {
          "code_snippet": "df['PO Line ID'] = df['PO Number'].astype(str) + '-' + df['PO Line Item'].astype(str)",
          "description": "Converts column types",
          "line": 65,
          "operation": "astype"
        },
        {
          "code_snippet": "df['PO Line ID'] = df['PO Number'].astype(str) + '-' + df['PO Line Item'].astype(str)",
          "column": "PO Line ID",
          "description": "Creates/modifies column 'PO Line ID'",
          "line": 65,
          "operation": "column_assign"
        },
        {
          "code_snippet": "enrichment['PO Line ID'] = details['PO Line ID']",
          "column": "PO Line ID",
          "description": "Creates/modifies column 'PO Line ID'",
          "line": 83,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df['PO Line Item'] = df['PO Line Item'].fillna(0).astype(int)",
          "column": "PO Line Item",
          "description": "Creates/modifies column 'PO Line Item'",
          "line": 64,
          "operation": "column_assign"
        },
        {
          "code_snippet": "enrichment['PR Line'] = pd.to_numeric(",
          "column": "PR Line",
          "description": "Creates/modifies column 'PR Line'",
          "line": 100,
          "operation": "column_assign"
        },
        {
          "code_snippet": "enrichment['PR Number'] = pr_number.where(pr_number.notna(), ariba_number)",
          "column": "PR Number",
          "description": "Creates/modifies column 'PR Number'",
          "line": 96,
          "operation": "column_assign"
        },
        {
          "code_snippet": "enrichment['Requester'] = details['ARIBA shopping cart number : created by (Text)']",
          "column": "Requester",
          "description": "Creates/modifies column 'Requester'",
          "line": 86,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df = po_df.drop(columns=cols_to_drop)",
          "description": "Removes columns or rows",
          "line": 121,
          "operation": "drop"
        },
        {
          "code_snippet": "df['PO Line Item'] = df['PO Line Item'].fillna(0).astype(int)",
          "description": "Fills null values",
          "line": 64,
          "operation": "fillna"
        },
        {
          "code_snippet": "enriched = po_df.merge(",
          "description": "Joins two DataFrames",
          "join_type": "left",
          "line": 125,
          "on_column": "PO Line ID",
          "operation": "merge"
        },
        {
          "code_snippet": "df = df.sort_values(\"PO Line ID\").reset_index(drop=True)",
          "description": "Sorts by column values",
          "line": 157,
          "operation": "sort_values"
        }
      ],
      "path": "scripts/stage2_transform/04_enrich_po_line_items.py",
      "stage": "stage2_transform"
    },
    {
      "dependencies": [
        "06_calculate_grir",
        "06_prepare_po_line_items",
        "07_prepare_po_transactions"
      ],
      "docstring": "Stage 2: Calculate Cost Impact\n\nCalculates cost impact from GR and IR postings for each PO Line Item.\nTwo types: Simple (GLD + K/P/S/V) uses GR only, Complex uses GR/IR logic.\n\nDependencies: All stage1 scripts must run first\nInput: data/intermediate/po_line_items.csv, gr_postings.csv, ir_postings.csv\nOutput: data/intermediate/cost_impact.csv",
      "functions": [
        {
          "args": [
            "complex_po_ids",
            "gr_df",
            "ir_df",
            "po_df"
          ],
          "docstring": "Type 2: Cost impact based on GR/IR chronological processing.",
          "line": 87,
          "name": "calculate_complex_cost_impact",
          "semantics": {
            "aggregates": true,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "Posting Date",
              "Posting Type",
              "Unit Price"
            ],
            "renames_columns": true,
            "type_conversions": true
          }
        },
        {
          "args": [
            "gr_df",
            "simple_po_ids"
          ],
          "docstring": "Type 1: Cost impact = GR postings only (IR ignored).",
          "line": 68,
          "name": "calculate_simple_cost_impact",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "po_df"
          ],
          "docstring": "Classify PO Line Items into simple (Type 1) and complex (Type 2).\n\nType 1 (Simple): Vendor Category = GLD AND Account Category IN (K, P, S, V)\nType 2 (Complex): All others",
          "line": 47,
          "name": "classify_po_line_items",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load all required data files.",
          "line": 31,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 168,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save cost impact DataFrame to CSV.",
          "line": 159,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/cost_impact.csv",
        "data/intermediate/gr_postings.csv",
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "line_count": 206,
      "name": "05_calculate_cost_impact",
      "outputs": [
        "data/intermediate/cost_impact.csv",
        "data/intermediate/gr_postings.csv",
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "combined[\"Posting Date\"] = pd.to_datetime(combined[\"Posting Date\"])",
          "column": "Posting Date",
          "description": "Creates/modifies column 'Posting Date'",
          "line": 114,
          "operation": "column_assign"
        },
        {
          "code_snippet": "complex_gr[\"Posting Type\"] = \"GR\"",
          "column": "Posting Type",
          "description": "Creates/modifies column 'Posting Type'",
          "line": 102,
          "operation": "column_assign"
        },
        {
          "code_snippet": "complex_ir[\"Posting Type\"] = \"IR\"",
          "column": "Posting Type",
          "description": "Creates/modifies column 'Posting Type'",
          "line": 110,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df[\"Unit Price\"] = po_df[\"Purchase Value USD\"] / po_df[\"Ordered Quantity\"]",
          "column": "Unit Price",
          "description": "Creates/modifies column 'Unit Price'",
          "line": 118,
          "operation": "column_assign"
        },
        {
          "code_snippet": "for po_line_id, group in combined.groupby(\"PO Line ID\"):",
          "description": "Groups data for aggregation",
          "group_column": "PO Line ID",
          "line": 124,
          "operation": "groupby"
        },
        {
          "code_snippet": "complex_ir = complex_ir.rename(columns={",
          "column_renames": {
            "IR Effective Quantity": "Posting Qty",
            "Invoice Amount": "Posting Amount",
            "Invoice Posting Date": "Posting Date"
          },
          "description": "Renames columns",
          "line": 105,
          "operation": "rename"
        },
        {
          "code_snippet": "complex_gr = complex_gr.rename(columns={",
          "column_renames": {
            "GR Amount": "Posting Amount",
            "GR Effective Quantity": "Posting Qty",
            "GR Posting Date": "Posting Date"
          },
          "description": "Renames columns",
          "line": 97,
          "operation": "rename"
        },
        {
          "code_snippet": "combined = combined.sort_values([\"PO Line ID\", \"Posting Date\", \"Posting Type\"])",
          "description": "Sorts by column values",
          "line": 115,
          "operation": "sort_values"
        },
        {
          "code_snippet": "all_impact = all_impact.sort_values([\"PO Line ID\", \"Posting Date\"])",
          "description": "Sorts by column values",
          "line": 195,
          "operation": "sort_values"
        },
        {
          "code_snippet": "combined[\"Posting Date\"] = pd.to_datetime(combined[\"Posting Date\"])",
          "description": "Converts to datetime",
          "line": 114,
          "operation": "to_datetime"
        }
      ],
      "path": "scripts/stage2_transform/05_calculate_cost_impact.py",
      "stage": "stage2_transform"
    },
    {
      "dependencies": [
        "06_prepare_po_line_items",
        "08_prepare_grir_exposures"
      ],
      "docstring": "Stage 2: Calculate GRIR Exposures\n\nCalculates GRIR (Goods Receipt/Invoice Receipt variance) for Simple POs\n(GLD vendor + K/P/S/V account assignment). GRIR = IR - GR when IR > GR.\n\nThis tracks balance sheet exposure from invoices received but not yet\ngoods-receipted, which will eventually hit the Net Income Statement.\n\nDependencies: All stage1 scripts + 05_calculate_cost_impact.py must run first\nInput: data/intermediate/po_line_items.csv, gr_postings.csv, ir_postings.csv\nOutput: data/intermediate/grir_exposures.csv",
      "functions": [
        {
          "args": [
            "gr_df",
            "ir_df",
            "simple_po_ids",
            "snapshot_date",
            "unit_prices"
          ],
          "docstring": "Calculate GRIR exposure for each Simple PO Line ID.\n\nGRIR = IR - GR (when IR > GR)\n\nLogic:\n1. For each PO Line ID, combine GR and IR postings chronologically\n2. Track cumulative GR and IR\n3. Find first date when IR exceeded GR (first_exposure_date)\n4. Calculate current GRIR qty/value\n5. Calculate duration and time bucket",
          "line": 93,
          "name": "calculate_grir_exposures",
          "semantics": {
            "aggregates": true,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "Posting Date",
              "Posting Type"
            ],
            "renames_columns": true,
            "type_conversions": true
          }
        },
        {
          "args": [
            "days"
          ],
          "docstring": "Categorize days into time bucket.",
          "line": 85,
          "name": "categorize_time_bucket",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "po_df"
          ],
          "docstring": "Get PO Line IDs for Simple POs (GLD + K/P/S/V) that are NOT closed.\nThese are the POs where we track GRIR exposure.\n\nClosed POs are excluded - no exposure if PO is already closed.",
          "line": 56,
          "name": "get_simple_po_ids",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "po_df"
          ],
          "docstring": "Calculate unit price for each PO Line ID.",
          "line": 78,
          "name": "get_unit_prices",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "Unit Price"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load all required data files.",
          "line": 40,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 213,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save GRIR exposures DataFrame to CSV.",
          "line": 199,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "datetime",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/gr_postings.csv",
        "data/intermediate/grir_exposures.csv",
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "line_count": 249,
      "name": "06_calculate_grir",
      "outputs": [
        "data/intermediate/gr_postings.csv",
        "data/intermediate/grir_exposures.csv",
        "data/intermediate/ir_postings.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "combined[\"Posting Date\"] = pd.to_datetime(combined[\"Posting Date\"])",
          "column": "Posting Date",
          "description": "Creates/modifies column 'Posting Date'",
          "line": 137,
          "operation": "column_assign"
        },
        {
          "code_snippet": "simple_gr[\"Posting Type\"] = \"GR\"",
          "column": "Posting Type",
          "description": "Creates/modifies column 'Posting Type'",
          "line": 124,
          "operation": "column_assign"
        },
        {
          "code_snippet": "simple_ir[\"Posting Type\"] = \"IR\"",
          "column": "Posting Type",
          "description": "Creates/modifies column 'Posting Type'",
          "line": 132,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df[\"Unit Price\"] = po_df[\"Purchase Value USD\"] / po_df[\"Ordered Quantity\"]",
          "column": "Unit Price",
          "description": "Creates/modifies column 'Unit Price'",
          "line": 81,
          "operation": "column_assign"
        },
        {
          "code_snippet": "for po_line_id, group in combined.groupby(\"PO Line ID\"):",
          "description": "Groups data for aggregation",
          "group_column": "PO Line ID",
          "line": 143,
          "operation": "groupby"
        },
        {
          "code_snippet": "simple_gr = simple_gr.rename(columns={",
          "column_renames": {
            "GR Effective Quantity": "Posting Qty",
            "GR Posting Date": "Posting Date"
          },
          "description": "Renames columns",
          "line": 120,
          "operation": "rename"
        },
        {
          "code_snippet": "simple_ir = simple_ir.rename(columns={",
          "column_renames": {
            "IR Effective Quantity": "Posting Qty",
            "Invoice Posting Date": "Posting Date"
          },
          "description": "Renames columns",
          "line": 128,
          "operation": "rename"
        },
        {
          "code_snippet": "combined = combined.sort_values([\"PO Line ID\", \"Posting Date\", \"Posting Type\"])",
          "description": "Sorts by column values",
          "line": 138,
          "operation": "sort_values"
        },
        {
          "code_snippet": "combined[\"Posting Date\"] = pd.to_datetime(combined[\"Posting Date\"])",
          "description": "Converts to datetime",
          "line": 137,
          "operation": "to_datetime"
        }
      ],
      "path": "scripts/stage2_transform/06_calculate_grir.py",
      "stage": "stage2_transform"
    },
    {
      "dependencies": [
        "07_prepare_po_transactions"
      ],
      "docstring": "Stage 3: Prepare PO Line Items for Import\n\nMaps intermediate columns to database schema columns and calculates\nderived fields (open_po_qty, open_po_value).\n\nDependencies: All stage1 and stage2 scripts must run first\nInput: data/intermediate/po_line_items.csv, data/intermediate/cost_impact.csv\nOutput: data/import-ready/po_line_items.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Set is_capex = True if WBS indicates a capitalized PO.\n\nCapEx POs (C.* WBS prefix) don't hit P&L - they're capitalized assets.\nExamples: C.FT*, C.NF*, C.LF*, etc.\nThis flag enables reports to filter out CapEx when analyzing OpEx cost impact.",
          "line": 224,
          "name": "calculate_is_capex",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "is_capex"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "cost_df",
            "po_df"
          ],
          "docstring": "Calculate open_po_qty and open_po_value based on cost impact.\n\nLogic:\n- If raw status is CLOSED PO: trust it, set open_po_qty and open_po_value to 0\n- Otherwise: calculate open values from ordered - cost impact",
          "line": 54,
          "name": "calculate_open_values",
          "semantics": {
            "aggregates": true,
            "filters_data": true,
            "joins_data": true,
            "modifies_columns": [
              "Total Cost Impact Amount",
              "Total Cost Impact Qty"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Set wbs_validated = True if wbs_number exists in wbs_details.\n\nThis enables data quality reporting for POs with invalid/unknown WBS references\n(e.g., typos, capex WBS tracked in separate systems).",
          "line": 186,
          "name": "calculate_wbs_validated",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "wbs_validated"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "series"
          ],
          "docstring": "Clean numeric values that should be strings.\nRemoves .0 suffix from floats (e.g., '4002084960.0' -> '4002084960').",
          "line": 133,
          "name": "clean_numeric_string",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load intermediate data files.",
          "line": 41,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 292,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "po_df"
          ],
          "docstring": "Map CSV columns to database column names.",
          "line": 143,
          "name": "map_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "cost_impact_pct",
              "cost_impact_value",
              "fmt_po",
              "open_po_qty",
              "open_po_value"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save import-ready DataFrame to CSV.",
          "line": 283,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate output using Pandera contract (with fallback to basic checks).",
          "line": 246,
          "name": "validate_output",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "contracts.po_line_items_schema",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/cost_impact.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "line_count": 333,
      "name": "06_prepare_po_line_items",
      "outputs": [
        "data/intermediate/cost_impact.csv",
        "data/intermediate/po_line_items.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "return series.apply(",
          "description": "Applies function to data",
          "line": 138,
          "operation": "apply"
        },
        {
          "code_snippet": "output_df[db_col] = po_df[csv_col]",
          "description": "Filters rows based on boolean condition",
          "line": 152,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "po_df[\"Total Cost Impact Amount\"] = po_df[\"Total Cost Impact Amount\"].fillna(0)",
          "column": "Total Cost Impact Amount",
          "description": "Creates/modifies column 'Total Cost Impact Amount'",
          "line": 81,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df[\"Total Cost Impact Qty\"] = po_df[\"Total Cost Impact Qty\"].fillna(0)",
          "column": "Total Cost Impact Qty",
          "description": "Creates/modifies column 'Total Cost Impact Qty'",
          "line": 80,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"cost_impact_pct\"] = po_df[\"cost_impact_pct\"].round(6)",
          "column": "cost_impact_pct",
          "description": "Creates/modifies column 'cost_impact_pct'",
          "line": 172,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"cost_impact_value\"] = po_df[\"cost_impact_value\"].round(2)",
          "column": "cost_impact_value",
          "description": "Creates/modifies column 'cost_impact_value'",
          "line": 170,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"fmt_po\"] = is_ops_vendor",
          "column": "fmt_po",
          "description": "Creates/modifies column 'fmt_po'",
          "line": 178,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"fmt_po\"] = False",
          "column": "fmt_po",
          "description": "Creates/modifies column 'fmt_po'",
          "line": 180,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"is_capex\"] = df[\"wbs_number\"].str.startswith(\"C.\", na=False)",
          "column": "is_capex",
          "description": "Creates/modifies column 'is_capex'",
          "line": 235,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"open_po_qty\"] = po_df[\"open_po_qty\"].round(4)",
          "column": "open_po_qty",
          "description": "Creates/modifies column 'open_po_qty'",
          "line": 164,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"open_po_value\"] = po_df[\"open_po_value\"].round(2)",
          "column": "open_po_value",
          "description": "Creates/modifies column 'open_po_value'",
          "line": 166,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_validated\"] = False",
          "column": "wbs_validated",
          "description": "Creates/modifies column 'wbs_validated'",
          "line": 198,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_validated\"] = has_wbs & wbs_exists",
          "column": "wbs_validated",
          "description": "Creates/modifies column 'wbs_validated'",
          "line": 210,
          "operation": "column_assign"
        },
        {
          "code_snippet": "po_df = po_df.drop(columns=[\"Total Cost Impact Qty\", \"Total Cost Impact Amount\"])",
          "description": "Removes columns or rows",
          "dropped_columns": [
            "Total Cost Impact Amount",
            "Total Cost Impact Qty"
          ],
          "line": 128,
          "operation": "drop"
        },
        {
          "code_snippet": "valid_wbs = set(wbs_df[\"wbs_number\"].dropna().unique())",
          "description": "Removes null values",
          "line": 203,
          "operation": "dropna"
        },
        {
          "code_snippet": "po_df[\"Total Cost Impact Qty\"] = po_df[\"Total Cost Impact Qty\"].fillna(0)",
          "description": "Fills null values",
          "line": 80,
          "operation": "fillna"
        },
        {
          "code_snippet": "po_df[\"Total Cost Impact Amount\"] = po_df[\"Total Cost Impact Amount\"].fillna(0)",
          "description": "Fills null values",
          "line": 81,
          "operation": "fillna"
        },
        {
          "code_snippet": "cost_df.groupby(\"PO Line ID\")",
          "description": "Groups data for aggregation",
          "group_column": "PO Line ID",
          "line": 66,
          "operation": "groupby"
        },
        {
          "code_snippet": "po_df = po_df.merge(cost_agg, on=\"PO Line ID\", how=\"left\")",
          "description": "Joins two DataFrames",
          "join_type": "left",
          "line": 77,
          "on_column": "PO Line ID",
          "operation": "merge"
        }
      ],
      "path": "scripts/stage3_prepare/06_prepare_po_line_items.py",
      "stage": "stage3_prepare"
    },
    {
      "dependencies": [],
      "docstring": "Stage 3: Prepare PO Transactions for Import\n\nMaps cost impact data to database schema columns for po_transactions table.\n\nDependencies: stage2_transform/05_calculate_cost_impact.py must run first\nInput: data/intermediate/cost_impact.csv\nOutput: data/import-ready/po_transactions.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Generate unique transaction_id for each row.\nFormat: {po_line_id}-{type}-{date}-{seq}\n\nExample: 4581850069-1-GR-20221215-001",
          "line": 46,
          "name": "generate_transaction_id",
          "semantics": {
            "aggregates": true,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "_date_str",
              "_seq",
              "transaction_id"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load cost impact data.",
          "line": 38,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 178,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map CSV columns to database column names.",
          "line": 97,
          "name": "map_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "amount",
              "cost_impact_amount",
              "cost_impact_qty",
              "quantity"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save import-ready DataFrame to CSV.",
          "line": 169,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate output using Pandera contract (with fallback to basic checks).",
          "line": 128,
          "name": "validate_output",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "contracts.po_transactions_schema",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/cost_impact.csv"
      ],
      "line_count": 207,
      "name": "07_prepare_po_transactions",
      "outputs": [
        "data/intermediate/cost_impact.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "df[\"po_line_id\"].astype(str)",
          "description": "Converts column types",
          "line": 71,
          "operation": "astype"
        },
        {
          "code_snippet": "+ df[\"_seq\"].astype(str).str.zfill(3)",
          "description": "Converts column types",
          "line": 77,
          "operation": "astype"
        },
        {
          "code_snippet": "output_df[db_col] = df[csv_col]",
          "description": "Filters rows based on boolean condition",
          "line": 105,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"_date_str\"] = pd.to_datetime(df[\"posting_date\"], format=\"mixed\").dt.strftime(",
          "column": "_date_str",
          "description": "Creates/modifies column '_date_str'",
          "line": 60,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"_seq\"] = (",
          "column": "_seq",
          "description": "Creates/modifies column '_seq'",
          "line": 65,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"amount\"] = output_df[\"cost_impact_amount\"]",
          "column": "amount",
          "description": "Creates/modifies column 'amount'",
          "line": 119,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"cost_impact_amount\"] = output_df[\"cost_impact_amount\"].round(2)",
          "column": "cost_impact_amount",
          "description": "Creates/modifies column 'cost_impact_amount'",
          "line": 113,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"cost_impact_qty\"] = output_df[\"cost_impact_qty\"].round(4)",
          "column": "cost_impact_qty",
          "description": "Creates/modifies column 'cost_impact_qty'",
          "line": 111,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"quantity\"] = output_df[\"quantity\"].round(4)",
          "column": "quantity",
          "description": "Creates/modifies column 'quantity'",
          "line": 115,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"transaction_id\"] = (",
          "column": "transaction_id",
          "description": "Creates/modifies column 'transaction_id'",
          "line": 70,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.drop(columns=[\"_date_str\", \"_seq\"])",
          "description": "Removes columns or rows",
          "dropped_columns": [
            "_date_str",
            "_seq"
          ],
          "line": 81,
          "operation": "drop"
        },
        {
          "code_snippet": "df.groupby([\"po_line_id\", \"transaction_type\", \"_date_str\"]).cumcount() + 1",
          "description": "Groups data for aggregation",
          "group_columns": [
            "_date_str",
            "po_line_id",
            "transaction_type"
          ],
          "line": 66,
          "operation": "groupby"
        },
        {
          "code_snippet": "df = df.sort_values([\"po_line_id\", \"transaction_type\", \"posting_date\"]).copy()",
          "description": "Sorts by column values",
          "line": 56,
          "operation": "sort_values"
        },
        {
          "code_snippet": "df[\"_date_str\"] = pd.to_datetime(df[\"posting_date\"], format=\"mixed\").dt.strftime(",
          "description": "Converts to datetime",
          "line": 60,
          "operation": "to_datetime"
        }
      ],
      "path": "scripts/stage3_prepare/07_prepare_po_transactions.py",
      "stage": "stage3_prepare"
    },
    {
      "dependencies": [],
      "docstring": "Stage 2: Process WBS Data - Split, Parse, and Map Location\n\nCombines WBS data from all three sources (Projects, Operations, Ops Activities),\nparses WBS numbers and Sub Business Line codes, and maps location from Ops District.\n\nKey transformations:\n1. Split comma-separated WBS entries (Projects) into separate rows\n2. Parse WBS number format: J.XX.XXXXXX from strings like \"J.24.079733(WIS)\"\n3. Extract Sub Business Line codes as arrays:\n   - Projects: single code from brackets -> [\"WIS\"]\n   - Operations: comma-separated codes -> [\"SLKN\", \"WLPS\", \"WLES\"]\n   - Ops Activities: map full name to code -> [\"WLPS\"]\n4. Map location from Ops District (available in all three reports)\n5. Validate WBS format and flag non-standard entries\n\nDependencies: \n- scripts/stage1_clean/10_wbs_from_projects.py\n- scripts/stage1_clean/11_wbs_from_operations.py\n- scripts/stage1_clean/12_wbs_from_ops_activities.py\n\nInput: \n- data/intermediate/wbs_from_projects.csv\n- data/intermediate/wbs_from_operations.csv\n- data/intermediate/wbs_from_ops_activities.csv\n\nOutput: data/intermediate/wbs_processed.csv",
      "functions": [
        {
          "args": [
            "dfs"
          ],
          "docstring": "Combine all sources into a single DataFrame.",
          "line": 257,
          "name": "combine_sources",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load all WBS source files.",
          "line": 61,
          "name": "load_all_sources",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 326,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "source_name"
          ],
          "docstring": "Map location from Ops District using OPS_DISTRICT_TO_LOCATION mapping.",
          "line": 239,
          "name": "map_location_from_ops_district",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "location"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Parse Operations WBS entries.\nOperations can have multiple SBL codes (comma-separated in source).",
          "line": 144,
          "name": "parse_operations",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "sub_business_lines",
              "wbs_number"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Parse Ops Activities WBS entries.\nMaps full SBL names to codes, stores as single-element array.",
          "line": 185,
          "name": "parse_ops_activities",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "sub_business_line_from_wbs",
              "sub_business_line_mapped",
              "sub_business_lines",
              "wbs_number"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "raw_value"
          ],
          "docstring": null,
          "line": 159,
          "name": "parse_sbl_codes",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "wbs_string"
          ],
          "docstring": "Parse a single WBS entry to extract WBS number and SBL code.\n\nExamples:\n- \"J.24.079733(WIS)\" -> (\"J.24.079733\", \"WIS\")\n- \"J.25.166462\" -> (\"J.25.166462\", None)\n- \"Invalid\" -> (None, None)",
          "line": 75,
          "name": "parse_wbs_entry",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the processed DataFrame to CSV.",
          "line": 318,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Select and order final output columns.",
          "line": 289,
          "name": "select_output_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Split comma-separated WBS entries in Projects and parse each.\nEach WBS gets a single SBL code wrapped in array format.",
          "line": 111,
          "name": "split_and_parse_projects",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "sub_business_lines",
              "wbs_number"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "codes"
          ],
          "docstring": "Convert list of SBL codes to JSON array string for CSV storage.",
          "line": 100,
          "name": "to_sbl_array",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate WBS number format and flag non-standard entries.",
          "line": 272,
          "name": "validate_wbs_format",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "json",
        "pandas",
        "pathlib",
        "re",
        "sys",
        "typing"
      ],
      "inputs": [],
      "line_count": 389,
      "name": "07_process_wbs",
      "outputs": [],
      "pandas_operations": [
        {
          "code_snippet": "parsed = df[\"sap_wbs_raw\"].apply(lambda x: pd.Series(parse_wbs_entry(x)))",
          "description": "Applies function to data",
          "line": 155,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = df[\"sub_business_lines_raw\"].apply(parse_sbl_codes)",
          "description": "Applies function to data",
          "line": 166,
          "operation": "apply"
        },
        {
          "code_snippet": "parsed = df[\"sap_wbs_raw\"].apply(lambda x: pd.Series(parse_wbs_entry(x)))",
          "description": "Applies function to data",
          "line": 196,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = sbl_code.apply(lambda x: to_sbl_array([x]) if pd.notna(x) else None)",
          "description": "Applies function to data",
          "line": 217,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = df[\"sub_business_line_from_wbs\"].apply(",
          "description": "Applies function to data",
          "line": 223,
          "operation": "apply"
        },
        {
          "code_snippet": "df = df[available]",
          "description": "Filters rows based on boolean condition",
          "line": 313,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"location\"] = df[\"ops_district\"].map(OPS_DISTRICT_TO_LOCATION)",
          "column": "location",
          "description": "Creates/modifies column 'location'",
          "line": 244,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_line_from_wbs\"] = parsed[1]",
          "column": "sub_business_line_from_wbs",
          "description": "Creates/modifies column 'sub_business_line_from_wbs'",
          "line": 198,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_line_mapped\"] = df[\"sub_business_line_raw\"].map(SBL_NAME_TO_CODE)",
          "column": "sub_business_line_mapped",
          "description": "Creates/modifies column 'sub_business_line_mapped'",
          "line": 202,
          "operation": "column_assign"
        },
        {
          "code_snippet": "new_row[\"sub_business_lines\"] = to_sbl_array([sbl_code]) if sbl_code else None",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 136,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = df[\"sub_business_lines_raw\"].apply(parse_sbl_codes)",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 166,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = None",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 172,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = sbl_code.apply(lambda x: to_sbl_array([x]) if pd.notna(x) else None)",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 217,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"sub_business_lines\"] = df[\"sub_business_line_from_wbs\"].apply(",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 223,
          "operation": "column_assign"
        },
        {
          "code_snippet": "new_row[\"wbs_number\"] = wbs_number",
          "column": "wbs_number",
          "description": "Creates/modifies column 'wbs_number'",
          "line": 134,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_number\"] = parsed[0]",
          "column": "wbs_number",
          "description": "Creates/modifies column 'wbs_number'",
          "line": 156,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_number\"] = parsed[0]",
          "column": "wbs_number",
          "description": "Creates/modifies column 'wbs_number'",
          "line": 197,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.drop(columns=[\"sub_business_lines_raw\"])",
          "description": "Removes columns or rows",
          "dropped_columns": [
            "sub_business_lines_raw"
          ],
          "line": 167,
          "operation": "drop"
        },
        {
          "code_snippet": "df = df.drop(columns=[\"sub_business_line_raw\", \"sub_business_line_from_wbs\", \"sub_business_line_mapped\"])",
          "description": "Removes columns or rows",
          "dropped_columns": [
            "sub_business_line_from_wbs",
            "sub_business_line_mapped",
            "sub_business_line_raw"
          ],
          "line": 218,
          "operation": "drop"
        },
        {
          "code_snippet": "df = df.drop(columns=[\"sub_business_line_from_wbs\"])",
          "description": "Removes columns or rows",
          "dropped_columns": [
            "sub_business_line_from_wbs"
          ],
          "line": 226,
          "operation": "drop"
        },
        {
          "code_snippet": "df[\"sub_business_line_mapped\"] = df[\"sub_business_line_raw\"].map(SBL_NAME_TO_CODE)",
          "description": "Maps values using dictionary or function",
          "line": 202,
          "operation": "map"
        },
        {
          "code_snippet": "df[\"location\"] = df[\"ops_district\"].map(OPS_DISTRICT_TO_LOCATION)",
          "description": "Maps values using dictionary or function",
          "line": 244,
          "operation": "map"
        }
      ],
      "path": "scripts/stage2_transform/07_process_wbs.py",
      "stage": "stage2_transform"
    },
    {
      "dependencies": [],
      "docstring": "Stage 3: Prepare GRIR Exposures for Import\n\nMaps intermediate GRIR columns to database schema columns.\n\nDependencies: stage2_transform/06_calculate_grir.py must run first\nInput: data/intermediate/grir_exposures.csv\nOutput: data/import-ready/grir_exposures.csv",
      "functions": [
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load GRIR exposures data.",
          "line": 41,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 132,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map CSV columns to database column names.",
          "line": 49,
          "name": "map_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "grir_qty",
              "grir_value"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save import-ready DataFrame to CSV.",
          "line": 106,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate output using Pandera contract (with fallback to basic checks).",
          "line": 73,
          "name": "validate_output",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "contracts.grir_exposures_schema",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/grir_exposures.csv"
      ],
      "line_count": 173,
      "name": "08_prepare_grir_exposures",
      "outputs": [
        "data/intermediate/grir_exposures.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "bucket_df = df[df[\"time_bucket\"] == bucket]",
          "description": "Filters rows based on boolean condition",
          "line": 126,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "output_df[db_col] = df[csv_col]",
          "description": "Filters rows based on boolean condition",
          "line": 58,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "output_df[\"grir_qty\"] = output_df[\"grir_qty\"].round(4)",
          "column": "grir_qty",
          "description": "Creates/modifies column 'grir_qty'",
          "line": 65,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"grir_value\"] = output_df[\"grir_value\"].round(2)",
          "column": "grir_value",
          "description": "Creates/modifies column 'grir_value'",
          "line": 68,
          "operation": "column_assign"
        }
      ],
      "path": "scripts/stage3_prepare/08_prepare_grir_exposures.py",
      "stage": "stage3_prepare"
    },
    {
      "dependencies": [],
      "docstring": "Stage 3: Prepare WBS Details for Import\n\nMaps intermediate columns to database schema columns and handles\nduplicate WBS entries (same WBS from different sources).\n\nDuplicate handling strategy:\n- wbs_number is the primary key (globally unique across all FDP reports)\n- If duplicates found (shouldn't happen), keep first occurrence\n\nArray column handling:\n- sub_business_lines: JSON array in CSV -> PostgreSQL text[] literal format\n- Example: '[\"WLPS\", \"SLKN\"]' -> '{WLPS,SLKN}'\n\nDependencies: scripts/stage2_transform/07_process_wbs.py\nInput: data/intermediate/wbs_processed.csv\nOutput: data/import-ready/wbs_details.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Handle duplicate WBS entries.\n\nSince wbs_number is the primary key (globally unique across all FDP reports),\nwe check for any duplicates and fail if found.",
          "line": 68,
          "name": "handle_duplicates",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "json_str"
          ],
          "docstring": "Convert JSON array string to PostgreSQL text[] literal format.\n\nExamples:\n- '[\"WLPS\"]' -> '{WLPS}'\n- '[\"WLPS\", \"SLKN\", \"WLES\"]' -> '{WLPS,SLKN,WLES}'\n- None/NaN -> None",
          "line": 46,
          "name": "json_to_pg_array",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": true,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load intermediate WBS data.",
          "line": 38,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 164,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map intermediate columns to database column names.",
          "line": 93,
          "name": "map_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "sub_business_lines"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save import-ready DataFrame to CSV.",
          "line": 155,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate required columns are present and data is valid.",
          "line": 118,
          "name": "validate_output",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "json",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/wbs_processed.csv"
      ],
      "line_count": 201,
      "name": "09_prepare_wbs_details",
      "outputs": [
        "data/intermediate/wbs_processed.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "output_df[\"sub_business_lines\"] = output_df[\"sub_business_lines\"].apply(json_to_pg_array)",
          "description": "Applies function to data",
          "line": 110,
          "operation": "apply"
        },
        {
          "code_snippet": "output_df[db_col] = df[csv_col]",
          "description": "Filters rows based on boolean condition",
          "line": 102,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "output_df[\"sub_business_lines\"] = output_df[\"sub_business_lines\"].apply(json_to_pg_array)",
          "column": "sub_business_lines",
          "description": "Creates/modifies column 'sub_business_lines'",
          "line": 110,
          "operation": "column_assign"
        }
      ],
      "path": "scripts/stage3_prepare/09_prepare_wbs_details.py",
      "stage": "stage3_prepare"
    },
    {
      "dependencies": [],
      "docstring": "Stage 3: Prepare SAP Reservations for Import\n\nMaps intermediate columns to database schema columns and extracts\nderived fields (PO info, asset info).\n\nTransformations:\n1. Map CSV columns to database column names\n2. Extract po_number and po_line_number from \"Main - PO Line to Peg to Reservation\"\n3. Extract asset_code and asset_serial_number from \"Maximo Asset Num\"\n4. Convert Plant from float to string for plant_code\n5. Keep po_line_item_id as the full PO-Line composite key for relationship\n\nDependencies: scripts/stage1_clean/13_reservations.py\nInput: data/intermediate/reservations.csv\nOutput: data/import-ready/sap_reservations.csv",
      "functions": [
        {
          "args": [
            "series"
          ],
          "docstring": "Convert numeric series to clean string (remove .0 suffix).",
          "line": 189,
          "name": "clean_numeric_to_string",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": null,
          "line": 192,
          "name": "clean_val",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Convert Plant from float to string.\n\nInput: 3606.0 -> Output: \"3606\"",
          "line": 157,
          "name": "convert_plant_code",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Extract asset code and serial number from 'Maximo Asset Num'.\n\nFormat: \"XPS-CA|941\" -> asset_code=\"XPS-CA\", asset_serial_number=\"941\"\n\nNote: Some values may not have \"|\" separator (e.g., \"TCS92314Y1795\").\nIn those cases, the entire value goes to asset_code.",
          "line": 109,
          "name": "extract_asset_info",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "asset_code",
              "asset_serial_number"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": "Extract asset code and serial number from composite value.",
          "line": 127,
          "name": "extract_asset_parts",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": "Extract PO number and line number from composite key.",
          "line": 75,
          "name": "extract_parts",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Extract PO number and line number from 'Main - PO Line to Peg to Reservation'.\n\nFormat: \"4584632148-1\" -> po_number=\"4584632148\", po_line_number=1\nAlso keeps the full value as po_line_item_id for relationship lookup.",
          "line": 58,
          "name": "extract_po_info",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "po_line_item_id",
              "po_line_number",
              "po_number"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": null,
          "line": 171,
          "name": "float_to_str",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": "Load intermediate reservations data.",
          "line": 39,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 297,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map CSV columns to database column names.",
          "line": 204,
          "name": "map_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "po_line_number",
              "po_number",
              "reservation_line_number",
              "reservation_number"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save import-ready DataFrame to CSV.",
          "line": 288,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Validate output using required column checks.",
          "line": 258,
          "name": "validate_output",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "config.column_mappings",
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/reservations.csv"
      ],
      "line_count": 347,
      "name": "10_prepare_reservations",
      "outputs": [
        "data/intermediate/reservations.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "parts = df[source_col].apply(extract_asset_parts)",
          "description": "Applies function to data",
          "line": 139,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"asset_code\"] = parts.apply(lambda x: x[0])",
          "description": "Applies function to data",
          "line": 140,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"asset_serial_number\"] = parts.apply(lambda x: x[1])",
          "description": "Applies function to data",
          "line": 141,
          "operation": "apply"
        },
        {
          "code_snippet": "df[source_col] = df[source_col].apply(float_to_str)",
          "description": "Applies function to data",
          "line": 179,
          "operation": "apply"
        },
        {
          "code_snippet": "return series.apply(clean_val)",
          "description": "Applies function to data",
          "line": 201,
          "operation": "apply"
        },
        {
          "code_snippet": "parts = df[source_col].apply(extract_parts)",
          "description": "Applies function to data",
          "line": 92,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"po_number\"] = parts.apply(lambda x: x[0])",
          "description": "Applies function to data",
          "line": 93,
          "operation": "apply"
        },
        {
          "code_snippet": "parts.apply(lambda x: x[1]), errors=\"coerce\"",
          "description": "Applies function to data",
          "line": 95,
          "operation": "apply"
        },
        {
          "code_snippet": "output_df[\"reservation_line_number\"] = pd.to_numeric(",
          "description": "Converts column types",
          "line": 240,
          "operation": "astype"
        },
        {
          "code_snippet": "output_df[\"po_line_number\"] = pd.to_numeric(",
          "description": "Converts column types",
          "line": 250,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"po_line_number\"] = pd.to_numeric(",
          "description": "Converts column types",
          "line": 94,
          "operation": "astype"
        },
        {
          "code_snippet": "output_df[db_col] = df[csv_col]",
          "description": "Filters rows based on boolean condition",
          "line": 214,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "output_df[col] = df[col]",
          "description": "Filters rows based on boolean condition",
          "line": 229,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"asset_code\"] = pd.NA",
          "column": "asset_code",
          "description": "Creates/modifies column 'asset_code'",
          "line": 123,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"asset_code\"] = parts.apply(lambda x: x[0])",
          "column": "asset_code",
          "description": "Creates/modifies column 'asset_code'",
          "line": 140,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"asset_serial_number\"] = pd.NA",
          "column": "asset_serial_number",
          "description": "Creates/modifies column 'asset_serial_number'",
          "line": 124,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"asset_serial_number\"] = parts.apply(lambda x: x[1])",
          "column": "asset_serial_number",
          "description": "Creates/modifies column 'asset_serial_number'",
          "line": 141,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_line_item_id\"] = pd.NA",
          "column": "po_line_item_id",
          "description": "Creates/modifies column 'po_line_item_id'",
          "line": 72,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_line_item_id\"] = df[source_col].where(",
          "column": "po_line_item_id",
          "description": "Creates/modifies column 'po_line_item_id'",
          "line": 99,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"po_line_number\"] = pd.to_numeric(",
          "column": "po_line_number",
          "description": "Creates/modifies column 'po_line_number'",
          "line": 250,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_line_number\"] = pd.NA",
          "column": "po_line_number",
          "description": "Creates/modifies column 'po_line_number'",
          "line": 71,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_line_number\"] = pd.to_numeric(",
          "column": "po_line_number",
          "description": "Creates/modifies column 'po_line_number'",
          "line": 94,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"po_number\"] = clean_numeric_to_string(output_df[\"po_number\"])",
          "column": "po_number",
          "description": "Creates/modifies column 'po_number'",
          "line": 246,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_number\"] = pd.NA",
          "column": "po_number",
          "description": "Creates/modifies column 'po_number'",
          "line": 70,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"po_number\"] = parts.apply(lambda x: x[0])",
          "column": "po_number",
          "description": "Creates/modifies column 'po_number'",
          "line": 93,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"reservation_line_number\"] = pd.to_numeric(",
          "column": "reservation_line_number",
          "description": "Creates/modifies column 'reservation_line_number'",
          "line": 240,
          "operation": "column_assign"
        },
        {
          "code_snippet": "output_df[\"reservation_number\"] = clean_numeric_to_string(",
          "column": "reservation_number",
          "description": "Creates/modifies column 'reservation_number'",
          "line": 234,
          "operation": "column_assign"
        },
        {
          "code_snippet": "unique_plants = df[source_col].dropna().unique()",
          "description": "Removes null values",
          "line": 181,
          "operation": "dropna"
        }
      ],
      "path": "scripts/stage3_prepare/10_prepare_reservations.py",
      "stage": "stage3_prepare"
    },
    {
      "dependencies": [],
      "docstring": "Stage 1: Extract WBS Data from Projects Report\n\nReads the FDP Projects dashboard export and extracts/cleans WBS-related fields.\nThis script maintains 1:1 row traceability with the source file.\nWBS splitting (for comma-separated entries) happens in Stage 2.\n\nCaching: Extracts data from xlsx to CSV cache. Only reprocesses xlsx if:\n- Source file changed (different filename, mtime, or size)\n- Script code changed (including config dependencies)\n- Use --force to bypass cache\n\nDependencies: None (reads from raw)\nInput: data/raw/fdp/ProjectDashboard_Export_*.xlsx\nOutput: data/intermediate/wbs_from_projects.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Add source tracking columns.",
          "line": 147,
          "name": "add_source_metadata",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "operation_number",
              "ops_activity_number",
              "wbs_source"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Determine rig value - use Rigs column, fallback to Project Type.",
          "line": 132,
          "name": "determine_rig",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "rig"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Filter to only rows that have WBS data.",
          "line": 83,
          "name": "filter_rows_with_wbs",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [],
          "docstring": "Find the Projects dashboard export file.",
          "line": 53,
          "name": "find_input_file",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the Excel file and select relevant columns.",
          "line": 66,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "force"
          ],
          "docstring": null,
          "line": 186,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Map Ops District to Location.",
          "line": 116,
          "name": "map_location",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "location"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 178,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Select and order final output columns.",
          "line": 156,
          "name": "select_output_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Rename columns to standardized intermediate format.",
          "line": 98,
          "name": "standardize_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": true,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "argparse",
        "config.column_mappings",
        "pandas",
        "pathlib",
        "sys",
        "typing",
        "utils.xlsx_cache"
      ],
      "inputs": [
        "data/intermediate/wbs_from_projects.csv",
        "data/raw/fdp"
      ],
      "line_count": 271,
      "name": "10_wbs_from_projects",
      "outputs": [
        "data/intermediate/wbs_from_projects.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "df[\"rigs\"].notna() & (df[\"rigs\"].astype(str).str.strip() != \"\"),",
          "description": "Converts column types",
          "line": 135,
          "operation": "astype"
        },
        {
          "code_snippet": "from_rigs = df[\"rigs\"].notna() & (df[\"rigs\"].astype(str).str.strip() != \"\")",
          "description": "Converts column types",
          "line": 139,
          "operation": "astype"
        },
        {
          "code_snippet": "mask = df[wbs_col].notna() & (df[wbs_col].astype(str).str.strip() != \"\")",
          "description": "Converts column types",
          "line": 89,
          "operation": "astype"
        },
        {
          "code_snippet": "df = df[available]",
          "description": "Filters rows based on boolean condition",
          "line": 173,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"location\"] = df[\"ops_district\"].map(OPS_DISTRICT_TO_LOCATION)",
          "column": "location",
          "description": "Creates/modifies column 'location'",
          "line": 118,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"operation_number\"] = None",
          "column": "operation_number",
          "description": "Creates/modifies column 'operation_number'",
          "line": 150,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"ops_activity_number\"] = None",
          "column": "ops_activity_number",
          "description": "Creates/modifies column 'ops_activity_number'",
          "line": 151,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"rig\"] = df[\"rigs\"].where(",
          "column": "rig",
          "description": "Creates/modifies column 'rig'",
          "line": 134,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_source\"] = \"Project\"",
          "column": "wbs_source",
          "description": "Creates/modifies column 'wbs_source'",
          "line": 149,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"location\"] = df[\"ops_district\"].map(OPS_DISTRICT_TO_LOCATION)",
          "description": "Maps values using dictionary or function",
          "line": 118,
          "operation": "map"
        },
        {
          "code_snippet": "df = df.rename(columns=rename_map)",
          "description": "Renames columns",
          "line": 111,
          "operation": "rename"
        }
      ],
      "path": "scripts/stage1_clean/10_wbs_from_projects.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [],
      "docstring": "Stage 1: Extract WBS Data from Operations Report\n\nReads the FDP Operations dashboard export and extracts/cleans WBS-related fields.\nThis script maintains 1:1 row traceability with the source file.\n\nNote: Operations file has single WBS per row (no comma-separated entries).\nNote: Most operations rows (89%) have NULL WBS - these are filtered out.\nNote: No Plant Code column - will be enriched from Projects in Stage 2.\n\nCaching: Extracts data from xlsx to CSV cache. Only reprocesses xlsx if:\n- Source file changed (different filename, mtime, or size)\n- Script code changed (including config dependencies)\n- Use --force to bypass cache\n\nDependencies: None (reads from raw)\nInput: data/raw/fdp/OperationDashboard_Export_*.xlsx\nOutput: data/intermediate/wbs_from_operations.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Add source tracking and placeholder columns.",
          "line": 116,
          "name": "add_source_metadata",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "location",
              "ops_activity_number",
              "wbs_source"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Filter to only rows that have WBS data.",
          "line": 83,
          "name": "filter_rows_with_wbs",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [],
          "docstring": "Find the Operations dashboard export file.",
          "line": 53,
          "name": "find_input_file",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the Excel file and select relevant columns.",
          "line": 66,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "force"
          ],
          "docstring": null,
          "line": 159,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 151,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Select and order final output columns.",
          "line": 128,
          "name": "select_output_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Rename columns to standardized intermediate format.",
          "line": 98,
          "name": "standardize_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": true,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "argparse",
        "pandas",
        "pathlib",
        "sys",
        "typing",
        "utils.xlsx_cache"
      ],
      "inputs": [
        "data/intermediate/wbs_from_operations.csv",
        "data/raw/fdp"
      ],
      "line_count": 246,
      "name": "11_wbs_from_operations",
      "outputs": [
        "data/intermediate/wbs_from_operations.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "mask = df[wbs_col].notna() & (df[wbs_col].astype(str).str.strip() != \"\")",
          "description": "Converts column types",
          "line": 89,
          "operation": "astype"
        },
        {
          "code_snippet": "df = df[available]",
          "description": "Filters rows based on boolean condition",
          "line": 146,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"location\"] = None",
          "column": "location",
          "description": "Creates/modifies column 'location'",
          "line": 122,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"ops_activity_number\"] = None",
          "column": "ops_activity_number",
          "description": "Creates/modifies column 'ops_activity_number'",
          "line": 119,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_source\"] = \"Operation\"",
          "column": "wbs_source",
          "description": "Creates/modifies column 'wbs_source'",
          "line": 118,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.rename(columns=rename_map)",
          "description": "Renames columns",
          "line": 111,
          "operation": "rename"
        }
      ],
      "path": "scripts/stage1_clean/11_wbs_from_operations.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [],
      "docstring": "Stage 1: Extract WBS Data from Operation Activities Report\n\nReads the FDP Operation Activities dashboard export and extracts/cleans WBS-related fields.\nThis script maintains 1:1 row traceability with the source file.\n\nNote: Ops Activities has single WBS per row (no comma-separated entries).\nNote: Has explicit \"Sub Business Line\" column with full names (not bracket codes).\nNote: No Plant Code column - will be enriched from Projects in Stage 2.\n\nCaching: Extracts data from xlsx to CSV cache. Only reprocesses xlsx if:\n- Source file changed (different filename, mtime, or size)\n- Script code changed (including config dependencies)\n- Use --force to bypass cache\n\nDependencies: None (reads from raw)\nInput: data/raw/fdp/OperationActivityDashboard_Export_*.xlsx\nOutput: data/intermediate/wbs_from_ops_activities.csv",
      "functions": [
        {
          "args": [
            "df"
          ],
          "docstring": "Add source tracking and placeholder columns.",
          "line": 118,
          "name": "add_source_metadata",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [
              "location",
              "wbs_source"
            ],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Filter to only rows that have WBS data.",
          "line": 84,
          "name": "filter_rows_with_wbs",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [],
          "docstring": "Find the Operation Activities dashboard export file.",
          "line": 54,
          "name": "find_input_file",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the Excel file and select relevant columns.",
          "line": 67,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "force"
          ],
          "docstring": null,
          "line": 160,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 152,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Select and order final output columns.",
          "line": 129,
          "name": "select_output_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Rename columns to standardized intermediate format.",
          "line": 99,
          "name": "standardize_columns",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": true,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "argparse",
        "pandas",
        "pathlib",
        "sys",
        "typing",
        "utils.xlsx_cache"
      ],
      "inputs": [
        "data/intermediate/wbs_from_ops_activities.csv",
        "data/raw/fdp"
      ],
      "line_count": 247,
      "name": "12_wbs_from_ops_activities",
      "outputs": [
        "data/intermediate/wbs_from_ops_activities.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "mask = df[wbs_col].notna() & (df[wbs_col].astype(str).str.strip() != \"\")",
          "description": "Converts column types",
          "line": 90,
          "operation": "astype"
        },
        {
          "code_snippet": "df = df[available]",
          "description": "Filters rows based on boolean condition",
          "line": 147,
          "operation": "boolean_filter"
        },
        {
          "code_snippet": "df[\"location\"] = None",
          "column": "location",
          "description": "Creates/modifies column 'location'",
          "line": 123,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"wbs_source\"] = \"Operation Activity\"",
          "column": "wbs_source",
          "description": "Creates/modifies column 'wbs_source'",
          "line": 120,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df = df.rename(columns=rename_map)",
          "description": "Renames columns",
          "line": 113,
          "operation": "rename"
        }
      ],
      "path": "scripts/stage1_clean/12_wbs_from_ops_activities.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [
        "10_prepare_reservations"
      ],
      "docstring": "Stage 1: Clean Reservations\n\nReads raw reservations Excel file and performs:\n1. Removes rows where both business line columns (Profit Center and Cost Center)\n   have matching values of WCM, WCF, or WCD (internal transfers/overhead).\n2. Splits \"Reservation -Line\" column into components:\n   - reservation_line_id: Original combined key (e.g., \"6086214878-1\")\n   - reservation_number: The reservation part (e.g., \"6086214878\")\n   - reservation_line_number: The line number as integer (e.g., 1)\n3. Normalizes PO Line IDs to match po_line_items format:\n   - Strips leading zeros from line numbers (e.g., \"4584632148-00001\" -> \"4584632148-1\")\n   - Cleans PO numbers (removes .0 suffix from float conversion)\n\nDependencies: None (independent stage 1 script)\nInput: data/raw/reservations/Data Table - Open Reservation - *.xlsx\nOutput: data/intermediate/reservations.csv",
      "functions": [
        {
          "args": [
            "val"
          ],
          "docstring": "Remove .0 suffix from PO numbers (artifact of float conversion).",
          "line": 139,
          "name": "clean_po_number",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": null,
          "line": 80,
          "name": "extract_parts",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Remove rows where both Business Line columns have the same value\nAND that value is one of WCM, WCF, or WCD.\n\nThese represent internal transfers/overhead allocations.",
          "line": 163,
          "name": "filter_matching_business_lines",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": true,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": true
          }
        },
        {
          "args": [],
          "docstring": "Find the reservations input file using glob pattern.",
          "line": 39,
          "name": "find_input_file",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "filepath"
          ],
          "docstring": "Load the raw Excel file.",
          "line": 55,
          "name": "load_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [],
          "docstring": null,
          "line": 205,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "val"
          ],
          "docstring": "Strip leading zeros from line number part of PO Line ID.",
          "line": 121,
          "name": "normalize_po_line_id",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Normalize PO Line IDs to match po_line_items format.\n\nReservations format: \"4584632148-00001\" (5-digit zero-padded line number)\nPO Line Items format: \"4581850069-1\" (no padding)\n\nThis ensures proper joins between sap_reservations and po_line_items tables.",
          "line": 109,
          "name": "normalize_po_line_ids",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df",
            "filepath"
          ],
          "docstring": "Save the cleaned DataFrame to CSV.",
          "line": 197,
          "name": "save_data",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "df"
          ],
          "docstring": "Split 'Reservation -Line' column into components.\n\nInput format: \"6086214878-1\" (reservation_number-line_number)\n\nCreates:\n- reservation_line_id: Original combined value (for lookups/traceability)\n- reservation_number: The reservation part (for grouping)\n- reservation_line_number: The line number as integer (for sorting)",
          "line": 63,
          "name": "split_reservation_line_id",
          "semantics": {
            "aggregates": false,
            "filters_data": true,
            "joins_data": false,
            "modifies_columns": [
              "reservation_line_id",
              "reservation_line_number",
              "reservation_number"
            ],
            "renames_columns": false,
            "type_conversions": true
          }
        }
      ],
      "imports": [
        "pandas",
        "pathlib",
        "sys"
      ],
      "inputs": [
        "data/intermediate/reservations.csv",
        "data/raw/reservations"
      ],
      "line_count": 234,
      "name": "13_reservations",
      "outputs": [
        "data/intermediate/reservations.csv"
      ],
      "pandas_operations": [
        {
          "code_snippet": "df[po_line_col] = df[po_line_col].apply(normalize_po_line_id)",
          "description": "Applies function to data",
          "line": 151,
          "operation": "apply"
        },
        {
          "code_snippet": "df[po_num_col] = df[po_num_col].apply(clean_po_number)",
          "description": "Applies function to data",
          "line": 157,
          "operation": "apply"
        },
        {
          "code_snippet": "parts = df[source_col].apply(extract_parts)",
          "description": "Applies function to data",
          "line": 89,
          "operation": "apply"
        },
        {
          "code_snippet": "df[\"reservation_number\"] = parts.apply(lambda x: x[0]).astype(",
          "description": "Applies function to data",
          "line": 90,
          "operation": "apply"
        },
        {
          "code_snippet": "parts.apply(lambda x: x[1]), errors=\"coerce\"",
          "description": "Applies function to data",
          "line": 94,
          "operation": "apply"
        },
        {
          "code_snippet": "pc = df[\"Business Line by Profit Center\"].astype(\"string\").str.strip().str.upper()",
          "description": "Converts column types",
          "line": 174,
          "operation": "astype"
        },
        {
          "code_snippet": "cc = df[\"Business Line - By Cost Center\"].astype(\"string\").str.strip().str.upper()",
          "description": "Converts column types",
          "line": 175,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"reservation_line_id\"] = df[source_col].astype(str)",
          "description": "Converts column types",
          "line": 77,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"reservation_number\"] = parts.apply(lambda x: x[0]).astype(",
          "description": "Converts column types",
          "line": 90,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"reservation_line_number\"] = pd.to_numeric(",
          "description": "Converts column types",
          "line": 93,
          "operation": "astype"
        },
        {
          "code_snippet": "df[\"reservation_line_id\"] = df[source_col].astype(str)",
          "column": "reservation_line_id",
          "description": "Creates/modifies column 'reservation_line_id'",
          "line": 77,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"reservation_line_number\"] = pd.to_numeric(",
          "column": "reservation_line_number",
          "description": "Creates/modifies column 'reservation_line_number'",
          "line": 93,
          "operation": "column_assign"
        },
        {
          "code_snippet": "df[\"reservation_number\"] = parts.apply(lambda x: x[0]).astype(",
          "column": "reservation_number",
          "description": "Creates/modifies column 'reservation_number'",
          "line": 90,
          "operation": "column_assign"
        }
      ],
      "path": "scripts/stage1_clean/13_reservations.py",
      "stage": "stage1_clean"
    },
    {
      "dependencies": [],
      "docstring": "Data Pipeline Orchestrator\n\nRuns all data transformation scripts in the correct order to produce\nimport-ready CSV files from raw data.\n\nUsage:\n    python3 scripts/pipeline.py           # Run full pipeline\n    python3 scripts/pipeline.py --stage1  # Run only stage 1\n    python3 scripts/pipeline.py --stage2  # Run stages 1-2\n    python3 scripts/pipeline.py --stage3  # Run all stages (same as full)\n\nPipeline Stages:\n    Stage 1 (Clean):     Raw data \u2192 Intermediate (cleaned)\n    Stage 2 (Transform): Intermediate \u2192 Intermediate (enriched + cost impact)\n    Stage 3 (Prepare):   Intermediate \u2192 Import-ready (DB schema mapped)\n\nOutput:\n    data/import-ready/po_line_items.csv    \u2192 po_line_items table\n    data/import-ready/po_transactions.csv  \u2192 po_transactions table\n    data/import-ready/grir_exposures.csv   \u2192 grir_exposures table\n    data/import-ready/wbs_details.csv      \u2192 wbs_details table\n    data/import-ready/sap_reservations.csv \u2192 sap_reservations table",
      "functions": [
        {
          "args": [],
          "docstring": null,
          "line": 153,
          "name": "main",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "max_stage"
          ],
          "docstring": "Run the pipeline up to the specified stage.",
          "line": 108,
          "name": "run_pipeline",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "description",
            "script_path"
          ],
          "docstring": "Run a Python script and return success status.",
          "line": 75,
          "name": "run_script",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        },
        {
          "args": [
            "scripts",
            "stage_name"
          ],
          "docstring": "Run all scripts in a stage.",
          "line": 90,
          "name": "run_stage",
          "semantics": {
            "aggregates": false,
            "filters_data": false,
            "joins_data": false,
            "modifies_columns": [],
            "renames_columns": false,
            "type_conversions": false
          }
        }
      ],
      "imports": [
        "argparse",
        "datetime",
        "pathlib",
        "subprocess",
        "sys"
      ],
      "inputs": [],
      "line_count": 189,
      "name": "pipeline",
      "outputs": [],
      "pandas_operations": [],
      "path": "scripts/pipeline.py",
      "stage": "scripts"
    }
  ]
}